/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){function a(q){q=String(q);return q.charAt(0).toUpperCase()+q.slice(1)}function b(q,F){var D=-1,v=q?q.length:0;if("number"==typeof v&&-1<v&&v<=w)for(;++D<v;)F(q[D],D,q);else f(q,F)}function c(q){q=String(q).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(q)?q:a(q)}function f(q,F){for(var D in q)y.call(q,D)&&F(q[D],D,q)}function e(q){return null==q?a(q):x.call(q).slice(8,-1)}function d(q,F){var D=null!=q?typeof q[F]:"number";return!/^(?:boolean|number|string|undefined)$/.test(D)&&
("object"==D?!!q[F]:!0)}function h(q){return String(q).replace(/([ -])(?!$)/g,"$1?")}function g(q,F){var D=null;b(q,function(v,u){D=F(D,v,u,q)});return D}function n(q){function F(N){return g(N,function(J,I){var O=I.pattern||h(I);!J&&(J=RegExp("\\b"+O+" *\\d+[.\\w_]*","i").exec(q)||RegExp("\\b"+O+" *\\w+-[\\w]*","i").exec(q)||RegExp("\\b"+O+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(q))&&((J=String(I.label&&!RegExp(O,"i").test(I.label)?I.label:J).split("/"))[1]&&!/[\d.]+/.test(J[0])&&(J[0]+=
" "+J[1]),I=I.label||I,J=c(J[0].replace(RegExp(O,"i"),I).replace(RegExp("; *(?:"+I+"[_-])?","i")," ").replace(RegExp("("+I+")[-_.]?(\\w)","i"),"$1 $2")));return J})}function D(N){return g(N,function(J,I){return J||(RegExp(I+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(q)||0)[1]||null})}var v=m,u=q&&"object"==typeof q&&"String"!=e(q);u&&(v=q,q=null);var C=v.navigator||{},z=C.userAgent||"";q||(q=z);var K=u?!!C.likeChrome:/\bChrome\b/.test(q)&&!/internal|\n/i.test(x.toString()),
L=u?"Object":"ScriptBridgingProxyObject",M=u?"Object":"Environment",Q=u&&v.java?"JavaPackage":e(v.java),U=u?"Object":"RuntimeObject";M=(Q=/\bJava/.test(Q)&&v.java)&&e(v.environment)==M;var ca=Q?"a":"\u03b1",da=Q?"b":"\u03b2",Y=v.document||{},S=v.operamini||v.opera,V=t.test(V=u&&S?S["[[Class]]"]:e(S))?V:S=null,r,W=q;u=[];var X=null,T=q==z;z=T&&S&&"function"==typeof S.version&&S.version();var G=function(N){return g(N,function(J,I){return J||RegExp("\\b"+(I.pattern||h(I))+"\\b","i").exec(q)&&(I.label||
I)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),A=function(N){return g(N,function(J,I){return J||RegExp("\\b"+(I.pattern||h(I))+"\\b","i").exec(q)&&(I.label||I)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),H=F([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),P=function(N){return g(N,function(J,I,O){return J||(I[H]||I[/^[a-z]+(?: +[a-z]+\b)*/i.exec(H)]||RegExp("\\b"+h(O)+"(?:\\b|\\w*\\d)","i").exec(q))&&O})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),B=function(N){return g(N,function(J,I){var O=I.pattern||h(I);if(!J&&(J=RegExp("\\b"+O+"(?:/[\\d.]+|[ \\w.]*)","i").exec(q))){var R=J,Z=I.label||I,aa={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};O&&Z&&/^Win/i.test(R)&&!/^Windows Phone /i.test(R)&&(aa=aa[/[\d.]+$/.exec(R)])&&(R="Windows "+aa);R=String(R);O&&Z&&(R=R.replace(RegExp(O,"i"),Z));J=R=c(R.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return J})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);G&&(G=[G]);P&&!H&&(H=F([P]));if(r=/\bGoogle TV\b/.exec(H))H=r[0];/\bSimulator\b/i.test(q)&&(H=(H?H+" ":"")+"Simulator");"Opera Mini"==A&&/\bOPiOS\b/.test(q)&&u.push("running in Turbo/Uncompressed mode");"IE"==A&&/\blike iPhone OS\b/.test(q)?(r=n(q.replace(/like iPhone OS/,"")),P=r.manufacturer,H=r.product):/^iP/.test(H)?(A||(A="Safari"),B="iOS"+((r=/ OS ([\d_]+)/i.exec(q))?" "+r[1].replace(/_/g,"."):"")):"Konqueror"!=A||/buntu/i.test(B)?P&&"Google"!=P&&(/Chrome/.test(A)&&
!/\bMobile Safari\b/i.test(q)||/\bVita\b/.test(H))||/\bAndroid\b/.test(B)&&/^Chrome/.test(A)&&/\bVersion\//i.test(q)?(A="Android Browser",B=/\bAndroid\b/.test(B)?B:"Android"):"Silk"==A?(/\bMobi/i.test(q)||(B="Android",u.unshift("desktop mode")),/Accelerated *= *true/i.test(q)&&u.unshift("accelerated")):"PaleMoon"==A&&(r=/\bFirefox\/([\d.]+)\b/.exec(q))?u.push("identifying as Firefox "+r[1]):"Firefox"==A&&(r=/\b(Mobile|Tablet|TV)\b/i.exec(q))?(B||(B="Firefox OS"),H||(H=r[1])):!A||(r=!/\bMinefield\b/i.test(q)&&
/\b(?:Firefox|Safari)\b/.exec(A))?(A&&!H&&/[\/,]|^[^(]+?\)/.test(q.slice(q.indexOf(r+"/")+8))&&(A=null),(r=H||P||B)&&(H||P||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(B))&&(A=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(B)?B:r)+" Browser")):"Electron"==A&&(r=(/\bChrome\/([\d.]+)\b/.exec(q)||0)[1])&&u.push("Chromium "+r):B="Kubuntu";z||(z=D(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",h(A),"(?:Firefox|Minefield|NetFront)"]));
if(r="iCab"==G&&3<parseFloat(z)&&"WebKit"||/\bOpera\b/.test(A)&&(/\bOPR\b/.test(q)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(q)&&!/^(?:Trident|EdgeHTML)$/.test(G)&&"WebKit"||!G&&/\bMSIE\b/i.test(q)&&("Mac OS"==B?"Tasman":"Trident")||"WebKit"==G&&/\bPlayStation\b(?! Vita\b)/i.test(A)&&"NetFront")G=[r];"IE"==A&&(r=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(q)||0)[1])?(A+=" Mobile",B="Windows Phone "+(/\+$/.test(r)?r:r+".x"),u.unshift("desktop mode")):/\bWPDesktop\b/i.test(q)?(A="IE Mobile",B="Windows Phone 8.x",
u.unshift("desktop mode"),z||(z=(/\brv:([\d.]+)/.exec(q)||0)[1])):"IE"!=A&&"Trident"==G&&(r=/\brv:([\d.]+)/.exec(q))&&(A&&u.push("identifying as "+A+(z?" "+z:"")),A="IE",z=r[1]);if(T){if(d(v,"global"))if(Q&&(r=Q.lang.System,W=r.getProperty("os.arch"),B=B||r.getProperty("os.name")+" "+r.getProperty("os.version")),M){try{z=v.require("ringo/engine").version.join("."),A="RingoJS"}catch(N){(r=v.system)&&r.global.system==v.system&&(A="Narwhal",B||(B=r[0].os||null))}A||(A="Rhino")}else"object"==typeof v.process&&
!v.process.browser&&(r=v.process)&&("object"==typeof r.versions&&("string"==typeof r.versions.electron?(u.push("Node "+r.versions.node),A="Electron",z=r.versions.electron):"string"==typeof r.versions.nw&&(u.push("Chromium "+z,"Node "+r.versions.node),A="NW.js",z=r.versions.nw)),A||(A="Node.js",W=r.arch,B=r.platform,z=(z=/[\d.]+/.exec(r.version))?z[0]:null));else e(r=v.runtime)==L?(A="Adobe AIR",B=r.flash.system.Capabilities.os):e(r=v.phantom)==U?(A="PhantomJS",z=(r=r.version||null)&&r.major+"."+r.minor+
"."+r.patch):"number"==typeof Y.documentMode&&(r=/\bTrident\/(\d+)/i.exec(q))?(z=[z,Y.documentMode],(r=+r[1]+4)!=z[1]&&(u.push("IE "+z[1]+" mode"),G&&(G[1]=""),z[1]=r),z="IE"==A?String(z[1].toFixed(1)):z[0]):"number"==typeof Y.documentMode&&/^(?:Chrome|Firefox)\b/.test(A)&&(u.push("masking as "+A+" "+z),A="IE",z="11.0",G=["Trident"],B="Windows");B=B&&c(B)}z&&(r=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(z)||/(?:alpha|beta)(?: ?\d)?/i.exec(q+";"+(T&&C.appMinorVersion))||/\bMinefield\b/i.test(q)&&
"a")&&(X=/b/i.test(r)?"beta":"alpha",z=z.replace(RegExp(r+"\\+?$"),"")+("beta"==X?da:ca)+(/\d+\+?/.exec(r)||""));if("Fennec"==A||"Firefox"==A&&/\b(?:Android|Firefox OS)\b/.test(B))A="Firefox Mobile";else if("Maxthon"==A&&z)z=z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(H))"Xbox 360"==H&&(B=null),"Xbox 360"==H&&/\bIEMobile\b/.test(q)&&u.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(A)&&(!A||H||/Browser|Mobi/.test(A))||"Windows CE"!=B&&!/Mobi/i.test(q))if("IE"==A&&T)try{null===
v.external&&u.unshift("platform preview")}catch(N){u.unshift("embedded")}else(/\bBlackBerry\b/.test(H)||/\bBB10\b/.test(q))&&(r=(RegExp(H.replace(/ +/g," *")+"/([.\\d]+)","i").exec(q)||0)[1]||z)?(r=[r,/BB10/.test(q)],B=(r[1]?(H=null,P="BlackBerry"):"Device Software")+" "+r[0],z=null):this!=f&&"Wii"!=H&&(T&&S||/Opera/.test(A)&&/\b(?:MSIE|Firefox)\b/i.test(q)||"Firefox"==A&&/\bOS X (?:\d+\.){2,}/.test(B)||"IE"==A&&(B&&!/^Win/.test(B)&&5.5<z||/\bWindows XP\b/.test(B)&&8<z||8==z&&!/\bTrident\b/.test(q)))&&
!t.test(r=n.call(f,q.replace(t,"")+";"))&&r.name&&(r="ing as "+r.name+((r=r.version)?" "+r:""),t.test(A)?(/\bIE\b/.test(r)&&"Mac OS"==B&&(B=null),r="identify"+r):(r="mask"+r,A=V?c(V.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(r)&&(B=null),T||(z=null)),G=["Presto"],u.push(r));else A+=" Mobile";if(r=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(q)||0)[1]){r=[parseFloat(r.replace(/\.(\d)$/,".0$1")),r];if("Safari"==A&&"+"==r[1].slice(-1))A="WebKit Nightly",X="alpha",z=r[1].slice(0,-1);else if(z==
r[1]||z==(r[2]=(/\bSafari\/([\d.]+\+?)/i.exec(q)||0)[1]))z=null;r[1]=(/\bChrome\/([\d.]+)/i.exec(q)||0)[1];537.36==r[0]&&537.36==r[2]&&28<=parseFloat(r[1])&&"WebKit"==G&&(G=["Blink"]);T&&(K||r[1])?(G&&(G[1]="like Chrome"),r=r[1]||(r=r[0],530>r?1:532>r?2:532.05>r?3:533>r?4:534.03>r?5:534.07>r?6:534.1>r?7:534.13>r?8:534.16>r?9:534.24>r?10:534.3>r?11:535.01>r?12:535.02>r?"13+":535.07>r?15:535.11>r?16:535.19>r?17:536.05>r?18:536.1>r?19:537.01>r?20:537.11>r?"21+":537.13>r?23:537.18>r?24:537.24>r?25:537.36>
r?26:"Blink"!=G?"27":"28")):(G&&(G[1]="like Safari"),r=(r=r[0],400>r?1:500>r?2:526>r?3:533>r?4:534>r?"4+":535>r?5:537>r?6:538>r?7:601>r?8:"8"));G&&(G[1]+=" "+(r+="number"==typeof r?".x":/[.+]/.test(r)?"":"+"));"Safari"==A&&(!z||45<parseInt(z))&&(z=r)}"Opera"==A&&(r=/\bzbov|zvav$/.exec(B))?(A+=" ",u.unshift("desktop mode"),"zvav"==r?(A+="Mini",z=null):A+="Mobile",B=B.replace(RegExp(" *"+r+"$"),"")):"Safari"==A&&/\bChrome\b/.exec(G&&G[1])&&(u.unshift("desktop mode"),A="Chrome Mobile",z=null,/\bOS X\b/.test(B)?
(P="Apple",B="iOS 4.3+"):B=null);z&&0==z.indexOf(r=/[\d.]+$/.exec(B))&&-1<q.indexOf("/"+r+"-")&&(B=String(B.replace(r,"")).replace(/^ +| +$/g,""));G&&!/\b(?:Avant|Nook)\b/.test(A)&&(/Browser|Lunascape|Maxthon/.test(A)||"Safari"!=A&&/^iOS/.test(B)&&/\bSafari\b/.test(G[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(A)&&G[1])&&(r=G[G.length-1])&&u.push(r);u.length&&(u=["("+u.join("; ")+")"]);P&&H&&0>H.indexOf(P)&&u.push("on "+P);H&&u.push((/^on /.test(u[u.length-
1])?"":"on ")+H);if(B){var ba=(r=/ ([\d.+]+)$/.exec(B))&&"/"==B.charAt(B.length-r[0].length-1);B={architecture:32,family:r&&!ba?B.replace(r[0],""):B,version:r?r[1]:null,toString:function(){var N=this.version;return this.family+(N&&!ba?" "+N:"")+(64==this.architecture?" 64-bit":"")}}}(r=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(W))&&!/\bi686\b/i.test(W)?(B&&(B.architecture=64,B.family=B.family.replace(RegExp(" *"+r),"")),A&&(/\bWOW64\b/i.test(q)||T&&/\w(?:86|32)$/.test(C.cpuClass||C.platform)&&!/\bWin64; x64\b/i.test(q))&&
u.unshift("32-bit")):B&&/^OS X/.test(B.family)&&"Chrome"==A&&39<=parseFloat(z)&&(B.architecture=64);q||(q=null);v={};v.description=q;v.layout=G&&G[0];v.manufacturer=P;v.name=A;v.prerelease=X;v.product=H;v.ua=q;v.version=A&&z;v.os=B||{architecture:null,family:null,version:null,toString:function(){return"null"}};v.parse=n;v.toString=function(){return this.description||""};v.version&&u.unshift(z);v.name&&u.unshift(A);B&&A&&(B!=String(B).split(" ")[0]||B!=A.split(" ")[0]&&!H)&&u.push(H?"("+B+")":"on "+
B);u.length&&(v.description=u.join(" "));return v}var l={"function":!0,object:!0},m=l[typeof window]&&window||this,p=l[typeof exports]&&exports;l=l[typeof module]&&module&&!module.nodeType&&module;var k=p&&l&&"object"==typeof global&&global;!k||k.global!==k&&k.window!==k&&k.self!==k||(m=k);var w=Math.pow(2,53)-1,t=/\bOpera/;k=Object.prototype;var y=k.hasOwnProperty,x=k.toString,E=n();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(m.platform=E,define(function(){return E})):p&&
l?f(E,function(q,F){p[F]=q}):m.platform=E}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],b=0;b<a.length;b++){var c=document.createElement("meta");c.name=a[b].name;c.content=a[b].content;var f=window.document.head.querySelector('meta[name="'+c.name+'"]');f&&f.parentNode.removeChild(f);window.document.head.appendChild(c)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}function isIOSLessThen13(){var a=platform.os,b=a.family.toLowerCase();a=parseFloat(a.version);return"ios"===b&&13>a?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},b="undefined"!==typeof module&&module.exports,c=function(){for(var d,h=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],g=0,n=h.length,l={};g<n;g++)if((d=h[g])&&d[1]in a){for(g=0;g<d.length;g++)l[h[0][g]]=d[g];return l}return!1}(),f={change:c.fullscreenchange,error:c.fullscreenerror},e={request:function(d){return new Promise(function(h,g){var n=function(){this.off("change",
n);h()}.bind(this);this.on("change",n);d=d||a.documentElement;Promise.resolve(d[c.requestFullscreen]())["catch"](g)}.bind(this))},exit:function(){return new Promise(function(d,h){if(this.isFullscreen){var g=function(){this.off("change",g);d()}.bind(this);this.on("change",g);Promise.resolve(a[c.exitFullscreen]())["catch"](h)}else d()}.bind(this))},toggle:function(d){return this.isFullscreen?this.exit():this.request(d)},onchange:function(d){this.on("change",d)},onerror:function(d){this.on("error",d)},
on:function(d,h){var g=f[d];g&&a.addEventListener(g,h,!1)},off:function(d,h){var g=f[d];g&&a.removeEventListener(g,h,!1)},raw:c};c?(Object.defineProperties(e,{isFullscreen:{get:function(){return!!a[c.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[c.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!a[c.fullscreenEnabled]}}}),b?module.exports=e:window.screenfull=e):b?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
var s_iScaleFactor=1,s_bIsIphone=!1,s_iOffsetX,s_iOffsetY,s_bFocus=!0;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||
navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var b=a.toLowerCase(),c=window.document,f=c.documentElement;if(void 0===window["inner"+a])a=f["client"+a];else if(window["inner"+a]!=f["client"+a]){var e=c.createElement("body");e.id="vpw-test-b";e.style.cssText="overflow:scroll";var d=c.createElement("div");d.id="vpw-test-d";d.style.cssText="position:absolute;top:-1000px";d.innerHTML="<style>@media("+b+":"+f["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+b+":7px!important}}</style>";e.appendChild(d);f.insertBefore(e,c.head);
a=7==d["offset"+a]?f["client"+a]:window["inner"+a];f.removeChild(e)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIpad(){var a=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!a&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:a}function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var b=getSize("Width");s_bFocus&&_checkOrientation(b,a);var c=Math.min(a/CANVAS_HEIGHT,b/CANVAS_WIDTH),f=Math.round(CANVAS_WIDTH*c);c=Math.round(CANVAS_HEIGHT*c);if(c<a){var e=a-c;c+=e;f+=CANVAS_WIDTH/CANVAS_HEIGHT*e}else f<b&&(e=b-f,f+=e,c+=CANVAS_HEIGHT/CANVAS_WIDTH*e);e=a/2-c/2;var d=b/2-f/2,h=CANVAS_WIDTH/f;if(d*h<-EDGEBOARD_X||
e*h<-EDGEBOARD_Y)c=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),b/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=Math.round(CANVAS_WIDTH*c),c=Math.round(CANVAS_HEIGHT*c),e=(a-c)/2,d=(b-f)/2,h=CANVAS_WIDTH/f;s_iOffsetX=-1*d*h;s_iOffsetY=-1*e*h;0<=e&&(s_iOffsetY=0);0<=d&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos();null!==s_oMenu&&s_oMenu.refreshButtonPos();null!==s_oSelectPlayers&&s_oSelectPlayers.refreshButtonPos();$("#canvas").css("width",f+"px");$("#canvas").css("height",c+"px");0>e||(e=(a-
c)/2);$("#canvas").css("top",e+"px");$("#canvas").css("left",d+"px");fullscreenHandler()}}
function _checkOrientation(a,b){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>b?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function playSound(a,b,c){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(b),s_aSounds[a].loop(c),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].stop()}function setVolume(a,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].volume(b)}function setMute(a,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].mute(b)}
function createBitmap(a,b,c){var f=new createjs.Bitmap(a),e=new createjs.Shape;b&&c?e.graphics.beginFill("#fff").drawRect(0,0,b,c):e.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);f.hitArea=e;return f}function createSprite(a,b,c,f,e,d){a=null!==b?new createjs.Sprite(a,b):new createjs.Sprite(a);b=new createjs.Shape;b.graphics.beginFill("#000000").drawRect(-c,-f,e,d);a.hitArea=b;return a}function pad(a,b,c){a+="";return a.length>=b?a:Array(b-a.length+1).join(c||"0")+a}
function linearFunction(a,b,c,f,e){return(a-b)*(e-f)/(c-b)+f}function randomFloatBetween(a,b,c){"undefined"===typeof c&&(c=2);return parseFloat(Math.min(a+Math.random()*(b-a),b).toFixed(c))}function rotateVector2D(a,b){var c=b.getX()*Math.cos(a)+b.getY()*Math.sin(a),f=b.getX()*-Math.sin(a)+b.getY()*Math.cos(a);b.set(c,f)}function tweenVectorsOnX(a,b,c){return a+c*(b-a)}function shuffle(a){for(var b=a.length,c,f;0!==b;)f=Math.floor(Math.random()*b),--b,c=a[b],a[b]=a[f],a[f]=c;return a}
function bubbleSort(a){do{var b=!1;for(var c=0;c<a.length-1;c++)a[c]>a[c+1]&&(b=a[c],a[c]=a[c+1],a[c+1]=b,b=!0)}while(b)}function compare(a,b){return a.index>b.index?-1:a.index<b.index?1:0}function CircularList(a,b){this.arr=a;this.currentIndex=b||0}CircularList.prototype._getNextIndex=function(){var a=this.currentIndex;return a<this.arr.length-1?a+1:0};CircularList.prototype._getPrevIndex=function(){var a=this.currentIndex,b=this.arr;return 0<a?a-1:b.length-1};CircularList.prototype.getNext=function(){return this.arr[this._getNextIndex()]};
CircularList.prototype.getPrev=function(){return this.arr[this._getPrevIndex()]};CircularList.prototype.next=function(){this.currentIndex=this._getNextIndex();return this.current()};CircularList.prototype.prev=function(){this.currentIndex=this._getPrevIndex();return this.current()};CircularList.prototype.current=function(){return this.arr[this.currentIndex]};CircularList.prototype.removeElement=function(a){a=this.arr.indexOf(a);-1<a&&this.arr.splice(a,1)};CircularList.prototype.getArray=function(){return this.arr};
CircularList.prototype.setCurrent=function(a){a=this.arr.indexOf(a);return-1<a?(this.currentIndex=a,this.current()):null};function easeLinear(a,b,c,f){return c*a/f+b}function easeInQuad(a,b,c,f){return c*(a/=f)*a+b}function easeInSine(a,b,c,f){return-c*Math.cos(a/f*(Math.PI/2))+c+b}function easeInCubic(a,b,c,f){return c*(a/=f)*a*a+b}
function getTrajectoryPoint(a,b){var c=new createjs.Point,f=(1-a)*(1-a),e=a*a;c.x=f*b.start.x+2*(1-a)*a*b.traj.x+e*b.end.x;c.y=f*b.start.y+2*(1-a)*a*b.traj.y+e*b.end.y;return c}function formatTime(a){a/=1E3;var b=Math.floor(a/60);a=parseFloat(a-60*b).toFixed(1);var c="";c=10>b?c+("0"+b+":"):c+(b+":");return 10>a?c+("0"+a):c+a}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,b){var c=getBounds(a,.9);var f=getBounds(b,.98);return calculateIntersection(c,f)}
function calculateIntersection(a,b){var c,f,e,d;var h=a.x+(c=a.width/2);var g=a.y+(f=a.height/2);var n=b.x+(e=b.width/2);var l=b.y+(d=b.height/2);h=Math.abs(h-n)-(c+e);g=Math.abs(g-l)-(f+d);return 0>h&&0>g?(h=Math.min(Math.min(a.width,b.width),-h),g=Math.min(Math.min(a.height,b.height),-g),{x:Math.max(a.x,b.x),y:Math.max(a.y,b.y),width:h,height:g,rect1:a,rect2:b}):null}
function getBounds(a,b){var c={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){c.x2=-Infinity;c.y2=-Infinity;var f=a.children,e=f.length,d;for(d=0;d<e;d++){var h=getBounds(f[d],1);h.x<c.x&&(c.x=h.x);h.y<c.y&&(c.y=h.y);h.x+h.width>c.x2&&(c.x2=h.x+h.width);h.y+h.height>c.y2&&(c.y2=h.y+h.height)}Infinity==c.x&&(c.x=0);Infinity==c.y&&(c.y=0);Infinity==c.x2&&(c.x2=0);Infinity==c.y2&&(c.y2=0);c.width=c.x2-c.x;c.height=c.y2-c.y;delete c.x2;delete c.y2}else{if(a instanceof createjs.Bitmap){e=
a.sourceRect||a.image;d=e.width*b;var g=e.height*b}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){e=a.spriteSheet.getFrame(a.currentFrame);d=e.rect.width;g=e.rect.height;f=e.regX;var n=e.regY}else c.x=a.x||0,c.y=a.y||0;else c.x=a.x||0,c.y=a.y||0;f=f||0;d=d||0;n=n||0;g=g||0;c.regX=f;c.regY=n;e=a.localToGlobal(0-f,0-n);h=a.localToGlobal(d-f,g-n);d=a.localToGlobal(d-f,0-n);f=a.localToGlobal(0-f,g-n);c.x=
Math.min(Math.min(Math.min(e.x,h.x),d.x),f.x);c.y=Math.min(Math.min(Math.min(e.y,h.y),d.y),f.y);c.width=Math.max(Math.max(Math.max(e.x,h.x),d.x),f.x)-c.x;c.height=Math.max(Math.max(Math.max(e.y,h.y),d.y),f.y)-c.y}return c}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var b=a.length,c,f;0<b;)f=Math.floor(Math.random()*b),b--,c=a[b],a[b]=a[f],a[f]=c;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);a.dispatchEvent(b)}}};
(function(){function a(c){var f={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};c=c||window.event;c.type in f?document.body.className=f[c.type]:(document.body.className=this[b]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var b="hidden";b in document?document.addEventListener("visibilitychange",a):(b="mozHidden")in document?document.addEventListener("mozvisibilitychange",
a):(b="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(b="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var b=window.location.search.substring(1).split("&"),c=0;c<b.length;c++){var f=b[c].split("=");if(f[0]==a)return f[1]}}function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut())}
if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oSelectPlayers&&s_oSelectPlayers.resetFullscreenBut()});
function CSpriteLibrary(){var a={},b,c,f,e,d,h;this.init=function(g,n,l){b={};f=c=0;e=g;d=n;h=l};this.addSprite=function(g,n){if(!a.hasOwnProperty(g)){var l=new Image;a[g]=b[g]={szPath:n,oSprite:l,bLoaded:!1};c++}};this.getSprite=function(g){return a.hasOwnProperty(g)?a[g].oSprite:null};this._onSpritesLoaded=function(){c=0;d.call(h)};this._onSpriteLoaded=function(){e.call(h);++f===c&&this._onSpritesLoaded()};this.loadSprites=function(){for(var g in b)b[g].oSprite.oSpriteLibrary=this,b[g].oSprite.szKey=
g,b[g].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},b[g].oSprite.onerror=function(n){var l=n.currentTarget;setTimeout(function(){b[l.szKey].oSprite.src=b[l.szKey].szPath},500)},b[g].oSprite.src=b[g].szPath};this.setLoaded=function(g){a[g].bLoaded=!0};this.isLoaded=function(g){return a[g].bLoaded};this.getNumSprites=function(){return c}}
function CTextButton(a,b,c,f,e,d,h,g){var n,l,m,p,k,w,t,y,x,E,q,F;this._init=function(D,v,u,C,z,K,L,M){n=!1;p=[];k=[];F=createBitmap(u);l=u.width;m=u.height;var Q=Math.ceil(L/20);E=new createjs.Text(C,L+"px "+z,"#000000");var U=E.getBounds();E.textAlign="center";E.lineWidth=.9*l;E.textBaseline="alphabetic";E.x=u.width/2+Q;E.y=Math.floor(u.height/2)+U.height/3+Q;q=new createjs.Text(C,L+"px "+z,K);q.textAlign="center";q.textBaseline="alphabetic";q.lineWidth=.9*l;q.x=u.width/2;q.y=Math.floor(u.height/
2)+U.height/3;x=new createjs.Container;x.x=D;x.y=v;x.regX=u.width/2;x.regY=u.height/2;s_bMobile||(x.cursor="pointer");x.addChild(F,E,q);!1!==M&&s_oStage.addChild(x);this._initListener()};this.unload=function(){x.off("mousedown",t);x.off("pressup",y);s_oStage.removeChild(x)};this.setVisible=function(D){x.visible=D};this.setAlign=function(D){q.textAlign=D;E.textAlign=D};this.enable=function(){n=!1;F.filters=[];F.cache(0,0,l,m)};this.disable=function(){n=!0;var D=(new createjs.ColorMatrix).adjustSaturation(-100).adjustBrightness(40);
F.filters=[new createjs.ColorMatrixFilter(D)];F.cache(0,0,l,m)};this._initListener=function(){t=x.on("mousedown",this.buttonDown);y=x.on("pressup",this.buttonRelease)};this.addEventListener=function(D,v,u){p[D]=v;k[D]=u};this.addEventListenerWithParams=function(D,v,u,C){p[D]=v;k[D]=u;w=C};this.buttonRelease=function(){n||(playSound("click",1,!1),x.scaleX=1,x.scaleY=1,p[ON_MOUSE_UP]&&p[ON_MOUSE_UP].call(k[ON_MOUSE_UP],w))};this.buttonDown=function(){n||(x.scaleX=.9,x.scaleY=.9,p[ON_MOUSE_DOWN]&&p[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN]))};
this.setPosition=function(D,v){x.x=D;x.y=v};this.changeText=function(D){q.text=D;E.text=D};this.setX=function(D){x.x=D};this.setY=function(D){x.y=D};this.getButtonImage=function(){return x};this.getX=function(){return x.x};this.getY=function(){return x.y};this.getSprite=function(){return x};this._init(a,b,c,f,e,d,h,g);return this}
function CToggle(a,b,c,f,e){var d,h,g,n,l,m;this._init=function(p,k,w,t,y){h=[];g=[];var x=new createjs.SpriteSheet({images:[w],frames:{width:w.width/2,height:w.height,regX:w.width/2/2,regY:w.height/2},animations:{state_true:[0],state_false:[1]}});d=t;m=createSprite(x,"state_"+d,w.width/2/2,w.height/2,w.width/2,w.height);m.x=p;m.y=k;m.stop();m.cursor="pointer";y.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",n);m.off("pressup",l);e.removeChild(m)};this._initListener=function(){n=
m.on("mousedown",this.buttonDown);l=m.on("pressup",this.buttonRelease)};this.addEventListener=function(p,k,w){h[p]=k;g[p]=w};this.setActive=function(p){d=p;m.gotoAndStop("state_"+d)};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;playSound("click",1,!1);d=!d;m.gotoAndStop("state_"+d);h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(g[ON_MOUSE_UP],d)};this.buttonDown=function(){m.scaleX=.9;m.scaleY=.9;h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN])};this.setPosition=function(p,k){m.x=p;m.y=k};this._init(a,
b,c,f,e)}
function CGfxButton(a,b,c,f){var e,d,h,g,n,l,m;this._init=function(p,k,w,t){e=!1;d=1;h=[];g=[];m=createBitmap(w);m.x=p;m.y=k;m.scaleX=m.scaleY=d;m.regX=w.width/2;m.regY=w.height/2;m.cursor="pointer";t.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",n);m.off("pressup",l);f.removeChild(m)};this.setVisible=function(p){m.visible=p};this.setClickable=function(p){e=!p};this._initListener=function(){n=m.on("mousedown",this.buttonDown);l=m.on("pressup",this.buttonRelease)};this.addEventListener=
function(p,k,w){h[p]=k;g[p]=w};this.buttonRelease=function(){e||(m.scaleX=d,m.scaleY=d,h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(g[ON_MOUSE_UP]))};this.buttonDown=function(){e||(m.scaleX=.9*d,m.scaleY=.9*d,playSound("click",1,!1),h[ON_MOUSE_DOWN]&&h[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN]))};this.pulseAnimation=function(){createjs.Tween.get(m,{loop:!0}).to({scaleX:.9*d,scaleY:.9*d},850,createjs.Ease.quadOut).to({scaleX:d,scaleY:d},650,createjs.Ease.quadIn)};this.trembleAnimation=function(){createjs.Tween.get(m,
{loop:!0}).to({rotation:10, scale:1.25},75,createjs.Ease.quadOut).to({rotation:-10, scale:0.75},140,createjs.Ease.quadIn).to({rotation:0, scale:0},75,createjs.Ease.quadIn)};this.removeAnimation=function(){m.scale=d;m.rotation=0;createjs.Tween.removeTweens(m)};this.setPosition=function(p,k){m.x=p;m.y=k};this.setX=function(p){m.x=p};this.setY=function(p){m.y=p};this.setImage=function(p){m.image=p};this.getButtonImage=function(){return m};this.getX=function(){return m.x};this.getY=function(){return m.y};this._init(a,b,c,f);return this}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var a=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(a--,this._oText.font=a+"px "+this._szFont,this._oText.lineHeight=Math.round(a*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>a););this._iFontSize=a}},__verticalAlign:function(){if(this._bVerticalAlign){var a=this._oText.getBounds().height;this._oText.y-=
(a-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(a){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight),this._oDebugShape.x=this._x,this._oDebugShape.y=this._y,this._oContainer.addChild(this._oDebugShape));
this._oText=new createjs.Text(a,this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(a)},setVerticalAlign:function(a){this._bVerticalAlign=a},setOutline:function(a){null!==this._oText&&(this._oText.outline=a)},setShadow:function(a,b,c,f){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(a,b,c,f))},setColor:function(a){this._oText.color=a},setAlpha:function(a){this._oText.alpha=a},setAlign:function(a){this._oText.textAlign=a},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getX:function(){return this._x},
getY:function(){return this._y},getFontSize:function(){return this._iFontSize},setY:function(a){this._y=a;this._oText.y=this._y},setPos:function(a,b){this._x=a;this._y=b;this._oText.x=this._x;this._oText.y=this._y;if(this._bDebug){this._oContainer.removeChild(this._oDebugShape);var c="left"===this._oText.textAlign?0:-this._iWidth;this._oDebugShape=new createjs.Shape;this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(c,0,this._iWidth,this._iHeight);this._oDebugShape.x=this._x;this._oDebugShape.y=
this._y;this._oContainer.addChild(this._oDebugShape)}this.__autofit();this.__updateY();this.__verticalAlign()},refreshText:function(a){""===a&&(a=" ");null===this._oText&&this.__createText(a);this._oText.text=a;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(a,b,c,f,e,d,h,g,n,l,m,p,k,w,t,y,x){this._oContainer=a;this._x=b;this._y=c;this._iWidth=f;this._iHeight=e;this._bMultiline=y;this._iFontSize=d;this._szAlign=h;this._szColor=g;this._szFont=n;this._iPaddingH=m;this._iPaddingV=p;this._bVerticalAlign=t;this._bFitText=w;this._bDebug=x;this._oDebugShape=null;this._fLineHeightFactor=l;this._oText=null;k&&this.__createText(k)}
!function(){function a(e){var d=e;if(f[d])d=f[d];else{for(var h=d,g,n=[],l=0;h;){if(null!==(g=c.text.exec(h)))n.push(g[0]);else if(null!==(g=c.modulo.exec(h)))n.push("%");else if(null!==(g=c.placeholder.exec(h))){if(g[2]){l|=1;var m=[],p=g[2],k;if(null!==(k=c.key.exec(p)))for(m.push(k[1]);""!==(p=p.substring(k[0].length));)if(null!==(k=c.key_access.exec(p)))m.push(k[1]);else if(null!==(k=c.index_access.exec(p)))m.push(k[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");g[2]=m}else l|=2;if(3===l)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push({placeholder:g[0],param_no:g[1],keys:g[2],sign:g[3],pad_char:g[4],align:g[5],width:g[6],precision:g[7],type:g[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");h=h.substring(g[0].length)}d=f[d]=n}h=arguments;g=1;n=d.length;m="";var w,t;for(p=0;p<n;p++)if("string"===typeof d[p])m+=d[p];
else if("object"===typeof d[p]){k=d[p];if(k.keys)for(l=h[g],w=0;w<k.keys.length;w++){if(void 0==l)throw Error(a('[sprintf] Cannot access property "%s" of undefined value "%s"',k.keys[w],k.keys[w-1]));l=l[k.keys[w]]}else l=k.param_no?h[k.param_no]:h[g++];c.not_type.test(k.type)&&c.not_primitive.test(k.type)&&l instanceof Function&&(l=l());if(c.numeric_arg.test(k.type)&&"number"!==typeof l&&isNaN(l))throw new TypeError(a("[sprintf] expecting number but found %T",l));c.number.test(k.type)&&(t=0<=l);
switch(k.type){case "b":l=parseInt(l,10).toString(2);break;case "c":l=String.fromCharCode(parseInt(l,10));break;case "d":case "i":l=parseInt(l,10);break;case "j":l=JSON.stringify(l,null,k.width?parseInt(k.width):0);break;case "e":l=k.precision?parseFloat(l).toExponential(k.precision):parseFloat(l).toExponential();break;case "f":l=k.precision?parseFloat(l).toFixed(k.precision):parseFloat(l);break;case "g":l=k.precision?String(Number(l.toPrecision(k.precision))):parseFloat(l);break;case "o":l=(parseInt(l,
10)>>>0).toString(8);break;case "s":l=String(l);l=k.precision?l.substring(0,k.precision):l;break;case "t":l=String(!!l);l=k.precision?l.substring(0,k.precision):l;break;case "T":l=Object.prototype.toString.call(l).slice(8,-1).toLowerCase();l=k.precision?l.substring(0,k.precision):l;break;case "u":l=parseInt(l,10)>>>0;break;case "v":l=l.valueOf();l=k.precision?l.substring(0,k.precision):l;break;case "x":l=(parseInt(l,10)>>>0).toString(16);break;case "X":l=(parseInt(l,10)>>>0).toString(16).toUpperCase()}if(c.json.test(k.type))m+=
l;else{if(!c.number.test(k.type)||t&&!k.sign)var y="";else y=t?"+":"-",l=l.toString().replace(c.sign,"");w=k.pad_char?"0"===k.pad_char?"0":k.pad_char.charAt(1):" ";var x=k.width-(y+l).length;x=k.width?0<x?w.repeat(x):"":"";m+=k.align?y+l+x:"0"===w?y+x+l:x+y+l}}return m}function b(e,d){return a.apply(null,[e].concat(d||[]))}var c={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,
placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},f=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=a,exports.vsprintf=b);"undefined"!==typeof window&&(window.sprintf=a,window.vsprintf=b,"function"===typeof define&&define.amd&&define(function(){return{sprintf:a,vsprintf:b}}))}();
var CANVAS_WIDTH=1920,CANVAS_HEIGHT=1080,EDGEBOARD_X=256,EDGEBOARD_Y=84,PRIMARY_FONT="RoundedMplus1c",FPS=120,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,ENABLE_FULLSCREEN=!0,GAME_PLAYERIO_ID="four-colors-o2yb5hcxu2o4lkmfuuykw",GAME_NAME="four_colors",MULTIPLAYER_TEST_LOCAL=!0,COMBINED_PLAYERS_MODE=!1,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,STATE_SELECT_PLAYERS=4,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_CARD_DEALED=6,ON_HOME=7,ON_CHECK=
8,ON_NEXT=9,ENABLE_CHECK_ORIENTATION,AD_SHOW_COUNTER,NUM_PLAYERS,STARTING_NUM_CARDS,CARD_WIDTH=156,CARD_HEIGHT=242,SOUNDTRACK_VOLUME_IN_GAME=.4,DEBUG_SHOW_CARDS=!1,CARD_SCORE=[0,1,2,3,4,5,6,7,8,9,20,20,20,50,50],NUM_PENALTY_CARDS=2,NUM_WILD_CARDS=4,GAME_SCORE_WIN=250,BOTTOM=0,TOP=1,LEFT=2,RIGHT=3,HAND_POS=[];HAND_POS.num_player_2=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP}];
HAND_POS.num_player_3=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2,side:RIGHT}];HAND_POS.num_player_4=[{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2+350,side:BOTTOM},{x:CANVAS_WIDTH/2-650,y:CANVAS_HEIGHT/2-40,side:LEFT},{x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT/2-350,side:TOP},{x:CANVAS_WIDTH/2+650,y:CANVAS_HEIGHT/2-40,side:RIGHT}];
var FOTOGRAM_COLOR=52,FOTOGRAM_DRAW_FOUR=53,ON_COLOR_SELECTED=0,ACTION_NEXT_TURN=0,ACTION_USE_CARD=1,ACTION_ON_SHUFFLECARDS=2,ACTION_ON_DRAWCARDS=3,ACTION_ON_UNO_CLICK=4,ACTION_SELECT_COLOR=5,ACTION_DRAW_FOUR=6,ACTION_BLOCK_TURN=7,ACTION_INVERT_TURN=8,ACTION_DRAW_TWO_COLORED=9,EFFECT_SELECT_COLOR=0,EFFECT_DRAW_FOUR=1,EFFECT_STOP=2,EFFECT_INVERT_TURN=3,EFFECT_DRAW_TWO_COLORED=4,EFFECT_NORMAL_CARD=5,ON_APPLY_EFFECT=0,ON_APPLY_PENALITY=1,ON_UNO_CLICK=2,DRAW_TYPE_NORMAL=0,DRAW_TYPE_PENALITY=1,DRAW_TYPE_DRAW2_COLORED=
2,DRAW_TYPE_DRAW4=3;
function CPreloader(){var a,b,c,f,e,d,h,g,n,l;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();l=new createjs.Container;s_oStage.addChild(l)};this.unload=function(){l.removeAllChildren();n.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(m);m=s_oSpriteLibrary.getSprite("200x200");h=createBitmap(m);h.regX=.5*m.width;h.regY=.5*m.height;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2-180;l.addChild(h);g=new createjs.Shape;g.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(h.x-100,h.y-100,200,200,10);l.addChild(g);h.mask=g;
m=s_oSpriteLibrary.getSprite("progress_bar");f=createBitmap(m);f.x=CANVAS_WIDTH/2-m.width/2;f.y=CANVAS_HEIGHT/2+50;l.addChild(f);a=m.width;b=m.height;e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,1,b);l.addChild(e);f.mask=e;c=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2+100;c.textBaseline="alphabetic";c.textAlign="center";l.addChild(c);m=s_oSpriteLibrary.getSprite("but_start");n=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,m,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 50",l);n.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);n.setVisible(!1);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);l.addChild(d);createjs.Tween.get(d).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(d);l.removeChild(d)})};this._onButStartRelease=function(){s_oMain.onRemovePreloader()};this.refreshLoader=function(m){c.text=m+"%";100===m&&(s_oMain.onRemovePreloader(),c.visible=
!1,f.visible=!1);e.graphics.clear();m=Math.floor(m*a/100);e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,m,b)};this._init()}
function CMain(a){var b,c=0,f=0,e=STATE_LOADING,d,h;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!0;createjs.Touch.enable(s_oStage,!0);s_bMobile=isMobile();!1===s_bMobile&&(s_oStage.enableMouseOver(FPS),$("body").on("contextmenu","#canvas",function(n){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;d=new CPreloader};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();b=!0};this.soundLoaded=function(){c++;d.refreshLoader(Math.floor(c/f*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,
volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});s_aSoundsInfo.push({path:"./sounds/",filename:"card_dealing",loop:!1,volume:1,ingamename:"card_dealing"});s_aSoundsInfo.push({path:"./sounds/",filename:"snap",loop:!1,volume:1,ingamename:"snap"});s_aSoundsInfo.push({path:"./sounds/",filename:"card",loop:!1,volume:1,ingamename:"card"});s_aSoundsInfo.push({path:"./sounds/",filename:"special_card",loop:!1,volume:1,ingamename:"special_card"});
s_aSoundsInfo.push({path:"./sounds/",filename:"change_color",loop:!1,volume:1,ingamename:"change_color"});f+=s_aSoundsInfo.length;s_aSounds=[];for(var n=0;n<s_aSoundsInfo.length;n++)this.tryToLoadSound(s_aSoundsInfo[n],!1)};this.tryToLoadSound=function(n,l){setTimeout(function(){s_aSounds[n.ingamename]=new Howl({src:[n.path+n.filename+".ogg"],autoplay:!1,preload:!0,loop:n.loop,volume:n.volume,onload:s_oMain.soundLoaded,onloaderror:function(m,p){for(var k=0;k<s_aSoundsInfo.length;k++)if(m===s_aSounds[s_aSoundsInfo[k].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[k],
!0);break}},onplayerror:function(m){for(var p=0;p<s_aSoundsInfo.length;p++)if(m===s_aSounds[s_aSoundsInfo[p].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[p].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[p].ingamename].play();"soundtrack"===s_aSoundsInfo[p].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},l?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play",
"./sprites/but_play.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("credits_panel","./sprites/credits_panel.png");s_oSpriteLibrary.addSprite("select_color_panel","./sprites/select_color_panel.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("but_yes_big","./sprites/but_yes_big.png");s_oSpriteLibrary.addSprite("but_exit_big","./sprites/but_exit_big.png");
s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_uno","./sprites/but_uno.png");s_oSpriteLibrary.addSprite("but_p2","./sprites/but_p2.png");s_oSpriteLibrary.addSprite("but_p3","./sprites/but_p3.png");s_oSpriteLibrary.addSprite("but_p4","./sprites/but_p4.png");s_oSpriteLibrary.addSprite("but_red","./sprites/_oButRed.png");s_oSpriteLibrary.addSprite("but_green","./sprites/_oButGreen.png");
s_oSpriteLibrary.addSprite("but_blue","./sprites/_oButBlue.png");s_oSpriteLibrary.addSprite("but_yellow","./sprites/_oButYellow.png");s_oSpriteLibrary.addSprite("stop_turn","./sprites/stop_turn.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("bg_select_players","./sprites/bg_select_players.jpg");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon",
"./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("but_arrow","./sprites/arrow.png");s_oSpriteLibrary.addSprite("but_skip","./sprites/but_skip.png");s_oSpriteLibrary.addSprite("line_player","./sprites/line_players.png");s_oSpriteLibrary.addSprite("cards","./sprites/cards.png");s_oSpriteLibrary.addSprite("colors","./sprites/colors.png");s_oSpriteLibrary.addSprite("draw_four_anim","./sprites/draw_4.png");s_oSpriteLibrary.addSprite("draw_two_anim",
"./sprites/draw_2.png");s_oSpriteLibrary.addSprite("stop_turn_anim","./sprites/stop_turn.png");s_oSpriteLibrary.addSprite("clock_wise_anim","./sprites/change_clockwise.png");s_oSpriteLibrary.addSprite("change_color","./sprites/change_color.png");s_oSpriteLibrary.addSprite("cloud_uno","./sprites/cloud.png");s_oSpriteLibrary.addSprite("finger","./sprites/finger.png");s_oSpriteLibrary.addSprite("shuffle_anim","./sprites/shuffle_anim.png");s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png");
s_oSpriteLibrary.addSprite("but_show","./sprites/but_show.png");s_oSpriteLibrary.addSprite("score_icon","./sprites/score_icon.png");s_oSpriteLibrary.addSprite("info_label","./sprites/info_label.png");s_oSpriteLibrary.addSprite("cup_icon","./sprites/cup_icon.png");f+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){c++;d.refreshLoader(Math.floor(c/f*100))};this._onAllImagesLoaded=function(){};this.onRemovePreloader=function(){d.unload();s_oSoundtrack=
playSound("soundtrack",1,!0);this.gotoMenu()};this.gotoMenu=function(){new CMenu;e=STATE_MENU};this.gotoSelectPlayers=function(){new CSelectPlayers;e=STATE_SELECT_PLAYERS};this.gotoGame=function(){s_oGame=h=new CGameSingle(g);e=STATE_GAME};this.gotoHelp=function(){new CHelp;e=STATE_HELP};this.stopUpdate=function(){b=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();
b=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(n){if(!1!==b){var l=(new Date).getTime();s_iTimeElaps=l-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=l;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);e===STATE_GAME&&h.update();s_oStage.update(n)}};s_oMain=this;var g=a;ENABLE_CHECK_ORIENTATION=a.check_orientation;ENABLE_FULLSCREEN=a.fullscreen;
STARTING_NUM_CARDS=a.starting_num_cards;s_bAudioActive=a.audio_enable_on_startup;this.initContainer()}var s_bMobile,s_bAudioActive=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_bFullscreen=!1,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundtrack=null,s_oCanvas,s_bFirstGame=!0,s_aSounds,s_aSoundsInfo,s_oGame;
function CPanelTutorial(){var a,b,c,f,e,d,h;this.init=function(){h=new createjs.Container;d=0;a=new createjs.Container;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2;b=new createBitmap(s_oSpriteLibrary.getSprite("msg_box"));b.regX=398;b.regY=258.5;b.alpha=.8;a.addChild(b);s_oStage.addChild(a);c=new CGfxButton(a.getBounds().width/2-50,0,s_oSpriteLibrary.getSprite("but_arrow"),a);c.addEventListener(ON_MOUSE_DOWN,this.onButNext,this);var g=s_oSpriteLibrary.getSprite("but_arrow");f=new CGfxButton(-(a.getBounds().width/
2-50),0,g,a);f.addEventListener(ON_MOUSE_DOWN,this.onButBack,this);f.getButtonImage().rotation=180;e=new CGfxButton(a.getBounds().width/2-53,a.getBounds().height/2-53,s_oSpriteLibrary.getSprite("but_skip"),a);e.addEventListener(ON_MOUSE_DOWN,this.onButSkip,this);this.loadPage(d)};this.loadPage=function(g){switch(g){case 0:f.setVisible(!1);new CTLText(h,-300,-200,600,50,50,"center","#fff",PRIMARY_FONT,1.2,0,0,TEXT_WELCOME,!0,!0,!0,!1);new CTLText(h,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,
1.2,0,0,sprintf(TEXT_TUTORIAL1,GAME_SCORE_WIN),!0,!0,!0,!1);g=new CCard(-215,0,h,"card_1_7",0,0);g.setAnimTutorial("tutorial");a.addChild(h);break;case 1:f.setVisible(!0);new CTLText(h,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL2,CARD_SCORE[12]),!0,!0,!0,!1);g=new CCard(-215,0,h,"card_0_12",0,0);g.setAnimTutorial("draw2tutorial");break;case 2:new CTLText(h,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL3,CARD_SCORE[10]),!0,!0,!0,!1);
g=new CCard(-215,0,h,"card_1_7",0,0);g.setAnimTutorial("stopTurnTutorial");break;case 3:new CTLText(h,-80,-105,300,210,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL4,CARD_SCORE[11]),!0,!0,!0,!1);g=new CCard(-215,0,h,"card_1_7",0,0);g.setAnimTutorial("changeClockWiseTutorial");break;case 4:new CTLText(h,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL5,CARD_SCORE[13]),!0,!0,!0,!1);g=new CCard(-215,0,h,FOTOGRAM_COLOR,0,0);g.instantShow();break;case 5:c.setVisible(!0);
new CTLText(h,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL6,CARD_SCORE[14]),!0,!0,!0,!1);g=new CCard(-215,0,h,FOTOGRAM_DRAW_FOUR,0,0);g.instantShow();break;case 6:c.setVisible(!1),new CTLText(h,-80,-120,300,240,50,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_TUTORIAL7,NUM_PENALTY_CARDS),!0,!0,!0,!1),g=new createBitmap(s_oSpriteLibrary.getSprite("but_uno")),g.regX=50,g.regY=50.5,g.x=-215,g.scaleX=1.5,g.scaleY=1.5,h.addChild(g)}};this.onButNext=function(){d++;
h.removeAllChildren();this.loadPage(d)};this.onButBack=function(){d--;h.removeAllChildren();this.loadPage(d)};this.onButSkip=function(){s_oStage.removeChild(a);s_oGame._startGame()};this.init()}
function CTurnManager(){var a,b,c,f,e;this.init=function(){a=!0;for(var d=[],h=0;h<NUM_PLAYERS;h++)d.push(h);e=new CircularList(d);f=e.current();c=e.current();b=e.getNext();s_oTurnManager=this};this.changeClockWise=function(){a=!0===a?!1:!0};this.nextTurn=function(){!0===a?(e.next(),c=e.current(),b=e.getNext()):(e.prev(),c=e.current(),b=e.getPrev())};this.prevTurn=function(){!0===a?(e.prev(),c=e.current(),b=e.getNext()):(e.next(),c=e.current(),b=e.getPrev())};this.setTurn=function(d){e.setCurrent(d);
c=e.current();b=!0===a?e.getNext():e.getPrev()};this.setFirstPlayerToBegin=function(){do f++,f===NUM_PLAYERS&&(f=0);while(null===e.setCurrent(f));this.setTurn(f)};this.getFirstPlayerToBegin=function(){return f};this.resetClockWise=function(){a=!0};this.resetFirstPlayer=function(){f=-1};this.getTurn=function(){return c};this.getNextPlayer=function(){return b};this.getClockWise=function(){return a};this.removePlayer=function(d){d===c?(a?this.prevTurn():this.nextTurn(),e.removeElement(d)):(e.removeElement(d),
e.setCurrent(c))};this.init()}s_oTurnManager=null;
function CAnimation(){var a,b,c,f,e,d,h;this.init=function(){d=!1;var g=s_oSpriteLibrary.getSprite("draw_four_anim");g={images:[g],frames:{width:292,height:290,regX:146,regY:145},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}};g=new createjs.SpriteSheet(g);a=new createjs.Sprite(g,0);g=s_oSpriteLibrary.getSprite("draw_two_anim");g={images:[g],frames:{width:292,height:322,regX:146,regY:161},
animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],next:"stop",speed:.8},reverse:{frames:[13,12,11,10,9,8,7,6,5,4,3,2,1,0],next:[0],speed:.8},stop:[13]}};g=new createjs.SpriteSheet(g);b=new createjs.Sprite(g,0);g=s_oSpriteLibrary.getSprite("stop_turn_anim");c=new createBitmap(g,292,300);g=s_oSpriteLibrary.getSprite("clock_wise_anim");f=new createBitmap(g,292,300);g=s_oSpriteLibrary.getSprite("change_color");g={images:[g],frames:{width:328,height:315,regX:164,regY:157.5},animations:{anim:{frames:[0,
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],next:"anim",speed:.8},stop:[16],color_0:{frames:[0,1,2,3,4,5,6],speed:.8},color_1:{frames:[0,1,2],speed:.8},color_2:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],speed:.8},color_3:{frames:[0,1,2,3,4,5,6,7,8,9,10],speed:.8}}};g=new createjs.SpriteSheet(g);e=new createjs.Sprite(g,0);g=s_oSpriteLibrary.getSprite("shuffle_anim");g={images:[g],frames:{width:403,height:386,regX:201.5,regY:193},animations:{anim:{frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],
next:"anim"},idle:[17]}};g=new createjs.SpriteSheet(g);h=new createjs.Sprite(g,"idle")};this.drawFourAnim=function(g,n,l,m){a.alpha=0;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2;a.scaleX=.01;a.scaleY=.01;s_oStage.addChild(a);a.stop();playSound("special_card",.5,!1);(new createjs.Tween.get(a)).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call(function(){a.gotoAndPlay("anim")}).wait(1E3).call(function(){a.gotoAndPlay("reverse")}).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,
createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(a);s_oGame.drawCardsTween(g,n,l,m)})};this.drawTwoAnim=function(g,n,l,m){b.alpha=0;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2;b.scaleX=.01;b.scaleY=.01;s_oStage.addChild(b);b.stop();playSound("special_card",.5,!1);(new createjs.Tween.get(b)).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).wait(200).call(function(){b.gotoAndPlay("anim");setVolume("special_card",.2)}).wait(1E3).call(function(){b.gotoAndPlay("reverse");setVolume("special_card",
.1)}).wait(200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(b);s_oGame.drawCardsTween(g,n,l,m)})};this.stopTurn=function(){return new Promise(function(g,n){c.alpha=0;c.regX=146;c.regY=150;c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT/2;c.scaleX=.01;c.scaleY=.01;s_oStage.addChild(c);playSound("game_over",1,!1);(new createjs.Tween.get(c)).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({scaleX:1.6,scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({scaleX:1.6,
scaleY:1.6},200).to({scaleX:2,scaleY:2},200).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(c);g()})})};this.changeClockWise=function(g){return new Promise(function(n,l){f.alpha=0;f.rotation=0;f.regX=146;f.regY=150;f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2;f.scaleX=.01;f.scaleY=.01;s_oStage.addChild(f);playSound("special_card",.5,!1);!1===g?(new createjs.Tween.get(f)).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:360},500).wait(500).to({rotation:-360},
500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(f);n()}):(new createjs.Tween.get(f)).to({alpha:1,scaleX:2,scaleY:2},200,createjs.Ease.cubicOut).to({rotation:-360},500).wait(500).to({rotation:360},500).wait(500).to({alpha:0,scaleX:.01,scaleY:.01},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(f);n()})})};this.changeColor=function(g){return new Promise(function(n,l){e.alpha=0;e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2;e.scaleX=
.01;e.scaleY=.01;s_oStage.addChild(e);e.stop();playSound("change_color",.5,!1);(new createjs.Tween.get(e)).to({alpha:1,scaleX:1.4,scaleY:1.4},200,createjs.Ease.cubicOut).call(function(){e.gotoAndPlay("anim")}).wait(1300).call(function(){d=!0;e.on("animationend",s_oCAnimation.endAnimation,s_oCAnimation,!1,n);e.gotoAndStop(16);e.gotoAndPlay("color_"+g)})})};this.endAnimation=function(g,n){!0===d&&(stopSound("change_color"),playSound("special_card",1,!1),d=!1,e.removeAllEventListeners(),e.stop(),(new createjs.Tween.get(e)).to({scaleX:2,
scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({scaleX:2,scaleY:2},250).to({scaleX:1.4,scaleY:1.4},250).to({alpha:0,scaleX:.1,scaleY:.1},200,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(e);e.gotoAndStop(0);n()}))};this.shuffleAnimation=function(){return new Promise(function(g,n){h.alpha=0;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2;h.scaleX=.01;h.scaleY=.01;s_oStage.addChild(h);h.stop();(new createjs.Tween.get(h)).to({alpha:1,scaleX:1.6,scaleY:1.6},400,createjs.Ease.cubicOut).call(function(){h.gotoAndPlay("anim");
playSound("card_dealing",1,!0)}).wait(1700).call(function(){h.gotoAndStop("idle");stopSound("change_color")}).to({alpha:0,scaleX:.01,scaleY:.01},300,createjs.Ease.cubicIn).call(function(){s_oStage.removeChild(h);stopSound("card_dealing");g()})})};this.init();s_oCAnimation=this}s_oCAnimation=null;
function CMenu(){var a,b,c,f,e,d,h,g,n,l,m,p,k=null,w=null;this._init=function(){h=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(h);var t=s_oSpriteLibrary.getSprite("but_play");g=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-200,t,s_oStage);g.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);t=s_oSpriteLibrary.getSprite("but_info");e=t.width/2+10;d=t.height/2+10;m=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,t,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onCreditsBut,
this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t=s_oSpriteLibrary.getSprite("audio_icon"),c=CANVAS_WIDTH-t.height/2-10,f=t.height/2+10,l=new CToggle(c,f,t,s_bAudioActive,s_oStage),l.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);t=window.document;var y=t.documentElement;k=y.requestFullscreen||y.mozRequestFullScreen||y.webkitRequestFullScreen||y.msRequestFullscreen;w=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(k=!1);k&&screenfull.isEnabled&&
(t=s_oSpriteLibrary.getSprite("but_fullscreen"),a=e+t.width/2+10,b=d,p=new CToggle(a,b,t,s_bFullscreen,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(n);createjs.Tween.get(n).to({alpha:0},1E3).call(function(){n.visible=!1});null!==s_oSoundtrack&&setVolume("soundtrack",1);this.refreshButtonPos()};this.unload=function(){g.unload();g=null;n.visible=!1;m.unload();if(!1===DISABLE_SOUND_MOBILE||
!1===s_bMobile)l.unload(),l=null;k&&screenfull.isEnabled&&p.unload();s_oStage.removeAllChildren();s_oMenu=null};this.refreshButtonPos=function(){m.setPosition(e+s_iOffsetX,s_iOffsetY+d);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(c-s_iOffsetX,s_iOffsetY+f);k&&screenfull.isEnabled&&p.setPosition(a+s_iOffsetX,b+s_iOffsetY)};this.resetFullscreenBut=function(){k&&screenfull.isEnabled&&p.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?w.call(window.document):k.call(window.document.documentElement);
sizeHandler()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onCreditsBut=function(){new CCreditsPanel};this._onButPlayRelease=function(){this.unload();$(s_oMain).trigger("start_session");s_oMain.gotoSelectPlayers()};s_oMenu=this;this._init()}var s_oMenu=null;
function CSelectPlayers(){var a,b,c,f,e,d,h,g,n,l,m=null,p=null,k,w;this._init=function(){var t=createBitmap(s_oSpriteLibrary.getSprite("bg_select_players"));s_oStage.addChild(t);t=s_oSpriteLibrary.getSprite("but_p2");h=new CGfxButton(CANVAS_WIDTH/2-450,CANVAS_HEIGHT-500,t,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onButP2,this);t=s_oSpriteLibrary.getSprite("but_p3");g=new CGfxButton(CANVAS_WIDTH/2+10,CANVAS_HEIGHT-500,t,s_oStage);g.addEventListener(ON_MOUSE_UP,this._onButP3,this);t=s_oSpriteLibrary.getSprite("but_p4");
n=new CGfxButton(CANVAS_WIDTH/2+450,CANVAS_HEIGHT-500,t,s_oStage);n.addEventListener(ON_MOUSE_UP,this._onButP4,this);new CTLText(s_oStage,CANVAS_WIDTH/2-500,300,1E3,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_PLAYERS,!0,!0,!0,!1);t=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-t.height/2-10;b=t.height/2+10;w=new CGfxButton(a,b,t,s_oStage);w.addEventListener(ON_MOUSE_UP,this._onExit,this);e=CANVAS_WIDTH-t.width/2-100;d=t.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t=
s_oSpriteLibrary.getSprite("audio_icon"),k=new CToggle(e,d,t,s_bAudioActive,s_oStage),k.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);t=window.document;var y=t.documentElement;m=y.requestFullscreen||y.mozRequestFullScreen||y.webkitRequestFullScreen||y.msRequestFullscreen;p=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(m=!1);m&&screenfull.isEnabled&&(t=s_oSpriteLibrary.getSprite("but_fullscreen"),c=t.width/4+10,f=t.height/2+10,
l=new CToggle(c,f,t,s_bFullscreen,s_oStage),l.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));this.refreshButtonPos()};this._onButP2=function(){NUM_PLAYERS=2;this.unload();$(s_oMain).trigger("select_players",2);s_oMain.gotoGame()};this._onButP3=function(){NUM_PLAYERS=3;this.unload();$(s_oMain).trigger("select_players",3);s_oMain.gotoGame()};this._onButP4=function(){NUM_PLAYERS=4;this.unload();$(s_oMain).trigger("select_players",4);s_oMain.gotoGame()};this.unload=function(){w.unload();if(!1===
DISABLE_SOUND_MOBILE||!1===s_bMobile)k.unload(),k=null;m&&screenfull.isEnabled&&l.unload();h.unload();g.unload();n.unload();s_oStage.removeAllChildren();s_oSelectPlayers=null};this.refreshButtonPos=function(){w.setPosition(a-s_iOffsetX,s_iOffsetY+b);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.setPosition(e-s_iOffsetX,s_iOffsetY+d);m&&screenfull.isEnabled&&l.setPosition(c+s_iOffsetX,f+s_iOffsetY)};this.resetFullscreenBut=function(){m&&screenfull.isEnabled&&l.setActive(s_bFullscreen)};this._onFullscreen=
function(){s_bFullscreen?p.call(window.document):m.call(window.document.documentElement);sizeHandler()};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};s_oSelectPlayers=this;this._init()}var s_oSelectPlayers=null;
function CCard(a,b,c,f,e,d,h,g){var n,l,m,p,k,w,t,y,x,E,q,F,D;this._init=function(u,C,z,K,L,M,Q,U){F=z;p=L;k=M;m=K;this.setEffect(K);n=!1;D=Q;l=0===k||2===k?"red":"black";t=0;U&&(t=U);q=new createjs.Container;q.x=u;q.y=C;q.rotation=t;F.addChild(q);u={images:[s_oSpriteLibrary.getSprite("cards")],frames:{width:CARD_WIDTH,height:CARD_HEIGHT,regX:CARD_WIDTH/2,regY:CARD_HEIGHT/2},animations:{card_0_0:[0],card_0_1:[1],card_0_2:[2],card_0_3:[3],card_0_4:[4],card_0_5:[5],card_0_6:[6],card_0_7:[7],card_0_8:[8],
card_0_9:[9],card_0_10:[10],card_0_11:[11],card_0_12:[12],card_1_0:[13],card_1_1:[14],card_1_2:[15],card_1_3:[16],card_1_4:[17],card_1_5:[18],card_1_6:[19],card_1_7:[20],card_1_8:[21],card_1_9:[22],card_1_10:[23],card_1_11:[24],card_1_12:[25],card_2_0:[26],card_2_1:[27],card_2_2:[28],card_2_3:[29],card_2_4:[30],card_2_5:[31],card_2_6:[32],card_2_7:[33],card_2_8:[34],card_2_9:[35],card_2_10:[36],card_2_11:[37],card_2_12:[38],card_3_0:[39],card_3_1:[40],card_3_2:[41],card_3_3:[42],card_3_4:[43],card_3_5:[44],
card_3_6:[45],card_3_7:[46],card_3_8:[47],card_3_9:[48],card_3_10:[49],card_3_11:[50],card_3_12:[51],color:[52],draw_four:[53],back:[54],tutorial:{frames:[20,5,47,31],speed:.1},draw2tutorial:{frames:[12,25,38,51],speed:.1},stopTurnTutorial:{frames:[10,23,36,49],speed:.1},changeClockWiseTutorial:{frames:[11,24,37,50],speed:.1}}};u=new createjs.SpriteSheet(u);E=createSprite(u,"back",CARD_WIDTH/2,CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT);E.stop();q.addChild(E);E.on("mousedown",this._mouseDown);y=[];x=[]};
this.getCardSprite=function(){return E};this.setEffect=function(u){switch(u){case 52:w=EFFECT_SELECT_COLOR;break;case 53:w=EFFECT_DRAW_FOUR;break;default:switch(p){case 10:w=EFFECT_STOP;break;case 11:w=EFFECT_INVERT_TURN;break;case 12:w=EFFECT_DRAW_TWO_COLORED;break;default:w=u===FOTOGRAM_COLOR?EFFECT_SELECT_COLOR:u===FOTOGRAM_DRAW_FOUR?EFFECT_DRAW_FOUR:EFFECT_NORMAL_CARD}}};this.setAnimTutorial=function(u){E.gotoAndPlay(u)};this.unload=function(){E.off("mousedown",this._mouseDown);F.removeChild(q)};
this.unloadEvent=function(){E.off("mousedown",this._mouseDown)};this.saveInfo=function(){return{szFotogram:m,iRank:p,iSuit:k,bValue:!0}};this.instantShow=function(){E.gotoAndStop(m)};this.setValue=function(){E.gotoAndStop(m);playSound("card",1,!1);createjs.Tween.get(q).to({scaleX:1},200)};this.setActive=function(u){u?q.addChild(void 0):q.removeChild(void 0)};this.setVisible=function(u){q.visible=!0===u?!0:!1};this.onSetTurned=function(){n=!0};this.offSetTurned=function(){n=!1};this.moveCard=function(u,
C,z,K,L){var M=this;createjs.Tween.get(q).wait(L).to({x:u,y:C,rotation:z},K,createjs.Ease.linear).call(function(){s_oGame.playedCard(M)})};this.moveCardFirstHand=function(u,C,z,K,L){var M=this;createjs.Tween.get(q).wait(L).to({x:u,y:C,rotation:z},K,createjs.Ease.cubicOut).call(function(){playSound("card_dealing",1,!1);s_oGame.onCardDealed(M)})};this.moveFirstLastCard=function(u,C,z,K){var L=this;createjs.Tween.get(q).wait(K).to({x:u,y:C},z,createjs.Ease.linear).call(function(){s_oGame.onFirstLastCardDealed(L)})};
this.dispose=function(u,C,z,K,L){return new Promise(function(M,Q){createjs.Tween.get(q).wait(L).to({x:u,y:C,rotation:z},K,createjs.Ease.linear).call(function(){M()})})};this.setOnTop=function(){F.addChildAt(q,F.numChildren)};this.stackAndDeactive=function(u,C,z){createjs.Tween.get(q).to({x:u,y:C},z,createjs.Ease.cubicOut)};this._mouseDown=function(u){!1!==n&&s_oGame.playCard(v,u)};this.showCard=function(u,C){var z=this;createjs.Tween.get(q).wait(u).to({scaleX:.1},200).call(function(){z.setValue(C)}).call(function(){})};
this.showCardNoInput=function(u,C){var z=this;createjs.Tween.get(q).wait(u).to({scaleX:.1},200).call(function(){z.setValue(C)}).call(function(){n=!1})};this.hideCard=function(){var u=this;createjs.Tween.get(q).to({scaleX:.1},200).call(function(){u.setBack()})};this.jumpAnim=function(){var u=1E3*Math.random(),C=1E3*Math.random();createjs.Tween.get(q,{loop:!0}).wait(u).to({y:b-20},200,createjs.Ease.cubicOut).to({y:b},200,createjs.Ease.cubicIn).wait(C)};this.stopAllAnim=function(){q.y=b;createjs.Tween.removeTweens(q)};
this.setPos=function(u,C){q.x=u;q.y=C};this.setBack=function(){n=!1;E.gotoAndStop("back");var u=this;createjs.Tween.get(q).to({scaleX:1},200).call(function(){u.cardHidden()})};this.cardHidden=function(){y[ON_CARD_HIDE]&&y[ON_CARD_HIDE].call(x[ON_CARD_HIDE],this)};this.getEffect=function(){return w};this.getRank=function(){return p};this.getSuit=function(){return k};this.getColor=function(){return l};this.getFotogram=function(){return m};this.getPos=function(){return{x:q.x,y:q.y}};this.getSprite=function(){return q};
this.getLogicRect=function(){return new createjs.Rectangle(q.x-CARD_WIDTH/2,q.y-CARD_HEIGHT/2,CARD_WIDTH,CARD_HEIGHT)};this.getTurned=function(){return n};this.getGlobalToLocal=function(u,C){return E.globalToLocal(u/s_oStage.scaleX,C/s_oStage.scaleY)};this.getUniqueID=function(){return D};this.getRot=function(){return q.rotation};var v=this;this._init(a,b,c,f,e,d,h,g)}
function CDeckDisplayer(a,b,c,f){var e,d,h,g,n,l,m;this._init=function(){n=c;e=[];d=new createjs.Container;d.x=a;d.y=b;d.on("mousedown",this.onDraw,this);n.addChild(d);if(f){g=new createjs.Container;g.x=a;g.y=b;g.visible=!1;n.addChild(g);var p=s_oSpriteLibrary.getSprite("finger"),k=p.width/5,w=p.height/2;p=new createjs.SpriteSheet({images:[p],frames:{width:k,height:w,regX:k/2,regY:w/2},animations:{idle:{frames:[0,1,2,3,4,5,6,7,8,9],speed:.9}}});l=createSprite(p,"idle",k/2,w/2,k,w);l.scaleX=.5;l.scaleY=
.5;l.x=-100;l.y=-100;g.addChild(l)}h=!1};this.initializeDeck=function(){for(var p,k=0,w,t=0;4>t;t++)for(var y=0;10>y;y++)p=y,w=13*t+p,e.push(new CCard(0,0,d,w,p,t,k++,0));for(t=0;4>t;t++)for(y=0;9>y;y++)p=y+1,w=13*t+p,e.push(new CCard(0,0,d,w,p,t,k++,0));for(t=0;4>t;t++)for(y=0;2>y;y++)e.push(new CCard(0,0,d,13*t+10,10,t,k++,0)),e.push(new CCard(0,0,d,13*t+11,11,t,k++,0)),e.push(new CCard(0,0,d,13*t+12,12,t,k++,0));for(t=0;4>t;t++)e.push(new CCard(0,0,d,FOTOGRAM_COLOR,13,4,k++,0)),e.push(new CCard(0,
0,d,FOTOGRAM_DRAW_FOUR,14,4,k++,0))};this.initializeFromData=function(p){for(var k,w,t=0,y=0;y<p.length;y++){switch(p[y]){case FOTOGRAM_COLOR:k=13;w=4;break;case FOTOGRAM_DRAW_FOUR:k=14;w=4;break;default:k=p[y]%13,w=Math.floor(p[y]/13)}e.push(new CCard(0,0,d,p[y],k,w,t++))}};this.shuffle=function(){var p;for(p=e.length;p;p--){var k=Math.floor(Math.random()*p);var w=e[p-1];e[p-1]=e[k];e[k]=w}};this.clearCards=function(){for(var p=0;p<e.length;p++)e[p].unload();e=[]};this.moveContainer=function(p,k,
w,t){createjs.Tween.get(d).wait(t).to({x:p,y:k},w,createjs.Ease.linear)};this.takeFirstLastCard=function(){return e.pop()};this.takeLastCard=function(){return e.pop()};this.getLastCard=function(){return e[e.length-1]};this.getCardByIndex=function(p){return e[p]};this.removeCardByIndex=function(p){return e.splice(p,1)};this.pushCard=function(p){e.push(p)};this.getContainer=function(){return d};this.getLength=function(){return e.length};this.onDraw=function(){if(!1===h)s_oGame.onDraw()};this.disableInputUsedCards=
function(){e[e.length-1].offSetTurned()};this.disableInputDraw=function(){h=!0};this.enableInputDraw=function(){h=!1};this.getIndexChild=function(){return s_oStage.getChildIndex(d)};this.setChildDepth=function(p){s_oStage.addChildAt(d,p)};this.getGlobalPosition=function(){return{x:d.x,y:d.y}};this.setOnTop=function(){n.addChildAt(d,n.numChildren)};this.setHelp=function(){n.setChildIndex(g,n.numChildren-1);this.setPointer(!0);m=setTimeout(function(){g.visible=!0},5E3)};this.hideHelp=function(){clearTimeout(m);
g.visible=!1;this.setPointer(!1)};this.setPointer=function(p){d.cursor=p?"pointer":"default"};this.addNewCardUnderTheDeck=function(p){for(var k=0;k<p.length;k++)e.push(p[k])};this.removeAllCardUnderTheDeck=function(){for(var p=[],k=0;k<e.length-1;k++)e[k].unload(),p.push(e.shift()),k--;return p};this._init()}
function CHandDisplayer(a,b,c,f,e,d,h,g){var n,l,m,p,k,w,t,y,x,E,q,F,D;this.init=function(){n=!1;F=h;q=0;D=e;k=[];w=new createjs.Container;E=d;E.addChild(w);t=new CPlayerInfo(c,f,E,h);y=new CInfoLabel(c,f,E);y.setVisible(!1);var v={images:[s_oSpriteLibrary.getSprite("cloud_uno")],frames:{width:261,height:194,regX:130.5,regY:97},animations:{cloud1:[0],cloud2:[1]}};v=new createjs.SpriteSheet(v);x=new createjs.Sprite(v,"cloud1");x.alpha=0;x.scaleX=.1;x.scaleY=.1;this.setPosition(a,b,c,f,g)};this.setPosition=
function(v,u,C,z,K){l=v;m=u;w.x=C;w.y=z;p=K;y.setPosition(w.x,w.y,p);switch(p){case BOTTOM:var L=w.x;var M=w.y-140;break;case TOP:l=-v;L=w.x;M=w.y+140;break;case LEFT:L=w.x+140;M=w.y;y.setPosition(w.x+20,w.y,p);break;case RIGHT:m=-u,L=w.x-140,M=w.y,y.setPosition(w.x-20,w.y,p)}t.setPosition(L,M,p)};this.clearCards=function(){for(var v=0;v<k.length;v++)k[v].unload();k=[]};this.getGlobalPosition=function(){for(var v=0,u=0,C=0;C<k.length;C++)0!==l?v+=CARD_WIDTH/2:u+=CARD_HEIGHT/2;return{x:w.x+v,y:w.y+
u}};this.getContainerPos=function(){return{x:w.x,y:w.y}};this.getCardPositionByIndex=function(v){v=k[v].getPos();return{x:v.x,y:v.y}};this.searchIndexCard=function(v){for(var u=0;u<k.length;u++)if(v===k[u])return u};this.removeCardByIndex=function(v){return k.splice(v,1)};this.getPosNewCard=function(){var v=this.getDynamicOffset(l),u=this.getDynamicOffset(m);return{x:k.length*v,y:k.length*u}};this.pushCard=function(v){k.push(v);if(0===m&&w.y>CANVAS_HEIGHT/2)k[k.length-1].getCardSprite().on("mouseover",
this.onMouseOver)};this.getContainer=function(){return w};this.getLastCard=function(){return k[k.length-1]};this.getLength=function(){return k.length};this.centerContainer=function(){var v=w.getBounds();var u=-(v.width/2)+CARD_WIDTH/2;p===TOP&&(u=v.width/2-CARD_WIDTH/2);var C=-(v.height/2)+CARD_WIDTH/2;p===RIGHT&&(C=v.height/2-CARD_WIDTH/2);0!==l?createjs.Tween.get(w).to({x:CANVAS_WIDTH/2+u},300,createjs.Ease.linear):createjs.Tween.get(w).to({y:CANVAS_HEIGHT/2+C-40},300,createjs.Ease.linear)};this.setOnTop=
function(){E.addChildAt(w,E.numChildren)};this.setChildDepth=function(v){v>w.s_oStage.numChild-1&&(v=w.s_oStage.numChild-1);s_oStage.addChildAt(v)};this.getContainerInfo=function(){return w.getBounds()};this.getCardByIndex=function(v){return k[v]};this.organizeHand=function(v){var u=this;if(0!==l)for(v=0;v<k.length;v++){var C=this.getDynamicOffset(l);C*=v;createjs.Tween.get(k[v].getSprite()).to({x:C},300,createjs.Ease.linear).call(u.centerContainer)}else for(v=0;v<k.length;v++)C=this.getDynamicOffset(m),
C*=v,createjs.Tween.get(k[v].getSprite()).to({y:C},300,createjs.Ease.linear).call(function(){u.centerContainer()})};this.getDynamicOffset=function(v){var u=v;6<k.length&&(u=linearFunction(k.length,7,20,v,.55*v));return u};this.setOnTurn=function(){t.highlight()};this.setOffTurn=function(){t.disable()};this.checkUno=function(){1===k.length&&(this.setOnTop(),0!==l?w.y<CANVAS_HEIGHT/2?(x.gotoAndStop("cloud2"),x.x=CANVAS_WIDTH/2-270,x.y=CANVAS_HEIGHT/2-300):(x.gotoAndStop("cloud1"),x.x=CANVAS_WIDTH/2+
300,x.y=CANVAS_HEIGHT/2+100):w.x<CANVAS_WIDTH/2?(x.gotoAndStop("cloud1"),x.x=CANVAS_WIDTH/2-350,x.y=CANVAS_HEIGHT/2-30):(x.gotoAndStop("cloud2"),x.x=CANVAS_WIDTH/2+350,x.y=CANVAS_HEIGHT/2-200),s_oStage.addChild(x),(new createjs.Tween.get(x)).to({alpha:1,scaleX:1,scaleY:1},300,createjs.Ease.bounceOut).wait(1500).to({scaleX:.1,scaleY:.1},300,createjs.Ease.cubicIn).to({alpha:0},20).call(function(){s_oStage.removeChild(x)}))};this.onMouseOver=function(v){s_bMobile||(v.target.cursor="pointer")};this.showAllCards=
function(){for(var v=0;v<k.length;v++)k[v].showCard()};this.changeName=function(v){F=v;t.setName(v)};this.refreshScore=function(){t.setScore(q);y.setVisible(!1)};this.getCardByUniqueID=function(v){for(var u=0;u<k.length;u++)if(k[u].getUniqueID()===v)return k[u]};this.getPlayerID=function(){return D};this.getName=function(){return F};this.getSide=function(){return p};this.getScore=function(){return q};this.setScore=function(v){q=v};this.showHandScore=function(v){y.setVisible(!0);y.setTextScore(v);
y.setOnTop()};this.hideMsgBox=function(){y.setVisible(!1);y.setTextScore("")};this.calculateHandScore=function(){for(var v=0,u=0;u<k.length;u++){var C=k[u].getRank();v+=CARD_SCORE[C]}return v};this.getAllCards=function(){return k};this.stopAllAnim=function(){for(var v=0;v<k.length;v++)k[v].stopAllAnim()};this.dispose=function(v,u){var C=this;n=!0;for(var z=k.length,K=0;K<k.length;K++)k[K].dispose(v,u,0,400,0).then(function(){z--;0===z&&C.clearCards()});this.showHandScore(TEXT_PLAYER_QUIT);y.stopAnim()};
this.isDisposed=function(){return n};this.init()}function CGameBase(a){this._iCounterDraw;this._oInterface;this._oParent;this._oDeck;this._aPlayersHand;this._oUsedCards;this._oTurnManager;this._iCurrentColor;this._bUNO;this._bEndGame;this._oAnimation;this._iCurPlayer;this._iNextPlayer;this._oFinger;this._oFade;this._oDecksContainer;this._oHandsContainer;this._oCardsContainer;this._oAIManager;this._oUnoController;this._oSummaryPanel;this._init()}
CGameBase.prototype._init=function(){this._bEndGame=this._bUNO=!1;this._iCounterDraw=0;this._oTurnManager=new CTurnManager;this._oAnimation=new CAnimation;var a=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));s_oStage.addChild(a);this._oUnoController=new CUnoController;this._oInterface=new CInterface;this._oCardsContainer=new createjs.Container;this._oHandsContainer=new createjs.Container;this._oPanelContainer=new createjs.Container;this._oDecksContainer=new createjs.Container;a=[];a[0]=TEXT_PLAYER_1;
a[1]=TEXT_PLAYER_2;a[2]=TEXT_PLAYER_3;a[3]=TEXT_PLAYER_4;this._aPlayersHand=[];for(var b=0;b<NUM_PLAYERS;b++){var c=0,f=0;HAND_POS["num_player_"+NUM_PLAYERS][b].x===CANVAS_WIDTH/2?c=CARD_WIDTH/2:f=CARD_HEIGHT/4;this._aPlayersHand[b]=new CHandDisplayer(c,f,HAND_POS["num_player_"+NUM_PLAYERS][b].x,HAND_POS["num_player_"+NUM_PLAYERS][b].y,b,this._oHandsContainer,a[b],HAND_POS["num_player_"+NUM_PLAYERS][b].side)}this._oCardsContainer.addChild(this._oDecksContainer);this._oCardsContainer.addChild(this._oHandsContainer);
s_oStage.addChild(this._oCardsContainer);s_oStage.addChild(this._oPanelContainer);this._oSummaryPanel=new CSummaryPanel(this._oPanelContainer);this._oSummaryPanel.addEventListener(ON_CHECK,this._onCheck,this);this._oMsgBox=new CMsgBox(this._oPanelContainer);this._oDeck=new CDeckDisplayer(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,this._oDecksContainer,!0);this._oUsedCards=new CDeckDisplayer(CANVAS_WIDTH/2+CARD_WIDTH,CANVAS_HEIGHT/2,this._oDecksContainer,!1);this._oUsedCards.disableInputDraw();this.setOffTurn();
this._oAIManager=new CAIManager;setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)};CGameBase.prototype.reset=function(){this._iCounterDraw=0;this._oTurnManager.setFirstPlayerToBegin();this._oTurnManager.resetClockWise();this._oDeck.clearCards();this._oUsedCards.clearCards();this._oUsedCards.disableInputDraw();for(var a=0;a<this._aPlayersHand.length;a++)this._aPlayersHand[a].clearCards(),this._aPlayersHand[a].refreshScore();this._oSummaryPanel.reset();this.setOffTurn()};
CGameBase.prototype.getFirstHand=function(){var a=this._oDeck.takeLastCard(),b=this._oTurnManager.getTurn(),c=this._aPlayersHand[b].getContainerPos(),f=this._aPlayersHand[b].getPosNewCard(),e=this._oDeck.getGlobalPosition();a.setOnTop();this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren);this._oDeck.setOnTop();b=this._getCardRotation(b);a.moveCardFirstHand(c.x+f.x-e.x,c.y+f.y-e.y,b,250)};
CGameBase.prototype.onCardDealed=function(a){var b=this._oTurnManager.getTurn(),c=this._getCardRotation(b);this._aPlayersHand[b].pushCard(new CCard(this._aPlayersHand[b].getPosNewCard().x,this._aPlayersHand[b].getPosNewCard().y,this._aPlayersHand[b].getContainer(),a.getFotogram(),a.getRank(),a.getSuit(),a.getUniqueID(),c));a.unload();a=this._aPlayersHand[b].getLastCard();this._aPlayersHand[b].centerContainer();this.canCardBeShown(b)&&a.showCard();this._oTurnManager.nextTurn();this.matchCanStart()?
(this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer),this._oDeck.setOnTop(),a=this._oDeck.takeFirstLastCard(),a.moveFirstLastCard(CARD_WIDTH,0,600)):this.getFirstHand()};
CGameBase.prototype.onFirstLastCardDealed=function(a){this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),a.getFotogram(),a.getRank(),a.getSuit(),a.getUniqueID(),0));a.unload();this._oUsedCards.getLastCard().showCardNoInput();this._oDeck.moveContainer(CANVAS_WIDTH/2-CARD_WIDTH/2,CANVAS_HEIGHT/2,400);this._oUsedCards.moveContainer(CANVAS_WIDTH/2+CARD_WIDTH/2,CANVAS_HEIGHT/2,400);this._iCurrentColor=this._oUsedCards.getLastCard().getSuit();this._oInterface.refreshColor(this._iCurrentColor);
this._iCurPlayer=this._oTurnManager.getTurn();this._iNextPlayer=this._oTurnManager.getNextPlayer();this._aPlayersHand[this._iCurPlayer].setOnTurn();this._oUsedCards.disableInputUsedCards();this._onFirstTurnStart()};CGameBase.prototype._onFirstTurnStart=function(){this._oTurnManager.prevTurn();this._iCurPlayer=this._oTurnManager.getTurn();this._iNextPlayer=this._oTurnManager.getNextPlayer();this.setOffTurn();var a=this._oUsedCards.getLastCard();this._checkFirstCardEffect(a.getEffect())};
CGameBase.prototype.cpuPlayCard=function(a){var b=this._iCurPlayer,c=this._aPlayersHand[b].getContainerPos(),f=this._oUsedCards.getGlobalPosition();this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren);this._aPlayersHand[b].setOnTop();a.moveCard(f.x-c.x,f.y-c.y,0,400,1E3);this._oDeck.setChildDepth(2);this._oUsedCards.setChildDepth(2);a.showCard(1E3)};
CGameBase.prototype.checkUno=function(a){var b=this._oTurnManager.getTurn();1===this._aPlayersHand[b].getLength()&&(this._bUNO=!0);this._oUnoController.check(a)};CGameBase.prototype.setUNO=function(a){this._bUNO=a};CGameBase.prototype.applyPenality=function(){this._bUNO=!1;this.drawCards(this._iCurPlayer,NUM_PENALTY_CARDS,0,DRAW_TYPE_PENALITY)};
CGameBase.prototype._checkEffect=function(a){switch(a){case EFFECT_SELECT_COLOR:this._applySelectColor();break;case EFFECT_DRAW_FOUR:this._applyDrawFourEffect();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._applyNormalCardEffect()}};
CGameBase.prototype.onDraw=function(){var a=!0;if(0!==this._oUsedCards.getLength()&&0===this._iCurPlayer){for(var b=0;b<this._aPlayersHand[0].getLength();b++){var c=this._aPlayersHand[0].getCardByIndex(b);this.cardMatchTheWaste(c)&&(a=!1)}!0===a&&(this._oDeck.disableInputDraw(),this._oDeck.hideHelp(),this.drawCards(0,1,0,DRAW_TYPE_NORMAL))}};
CGameBase.prototype._checkNumberCardsToDraw=function(a,b,c,f){this._iCounterDraw=b;switch(f){case DRAW_TYPE_PENALITY:this.drawCardsTween(a,b,c,f);break;case DRAW_TYPE_DRAW2_COLORED:s_oCAnimation.drawTwoAnim(a,b,c,f);break;case DRAW_TYPE_DRAW4:s_oCAnimation.drawFourAnim(a,b,c,f);break;default:this.drawCardsTween(a,b,c,f)}};
CGameBase.prototype.drawCardsTween=function(a,b,c,f){this._oCardsContainer.addChildAt(this._oDecksContainer,this._oCardsContainer.numChildren);this._oDeck.setOnTop();this._aPlayersHand[a].organizeHand();var e=this._aPlayersHand[a].getContainerPos(),d=this._aPlayersHand[a].getPosNewCard(),h=this._oDeck.getGlobalPosition(),g=this,n=this._oDeck.takeLastCard();n.setOnTop();var l=e.x+d.x-h.x;e=e.y+d.y-h.y;var m=this._getCardRotation(a);createjs.Tween.get(n.getSprite()).wait(c).to({x:l,y:e,rotation:m},
400,createjs.Ease.cubicOut).call(function(){g._aPlayersHand[a].pushCard(new CCard(g._aPlayersHand[a].getPosNewCard().x,g._aPlayersHand[a].getPosNewCard().y,g._aPlayersHand[a].getContainer(),n.getFotogram(),n.getRank(),n.getSuit(),n.getUniqueID(),m));n.unload();var p=g._aPlayersHand[a].getLastCard();g.canCardBeShown(a)?p.showCard():playSound("card",1,!1);g._aPlayersHand[a].centerContainer();g.checkForMoreDraws(a,b,c,f)})};
CGameBase.prototype.checkForMoreDraws=function(a,b,c,f){0===this._oDeck.getLength()?this.shuffleCards(a,b,c,f):(this._iCounterDraw--,0<this._iCounterDraw?this.drawCardsTween(a,b,c,f):this._onAllCardsDrawCompleted(a,f))};
CGameBase.prototype._checkEffectAfterDrawCompleted=function(a,b){switch(b){case DRAW_TYPE_PENALITY:this.applyEffectOnCard(this._oUsedCards.getLastCard().getEffect());break;case DRAW_TYPE_DRAW2_COLORED:this._oTurnManager.nextTurn();this._notifyChangeTurn();break;case DRAW_TYPE_DRAW4:this._oTurnManager.nextTurn();this._notifyChangeTurn();break;default:this._checkIfCanStillPlayTheTurn(a)}};CGameBase.prototype.onInputPlayer=function(a){for(var b=0;b<this._aPlayersHand[a].getLength();b++)this._aPlayersHand[a].getCardByIndex(b).onSetTurned()};
CGameBase.prototype.offInputPlayer=function(a){for(var b=0;b<this._aPlayersHand[a].getLength();b++)this._aPlayersHand[a].getCardByIndex(b).offSetTurned()};CGameBase.prototype.setOffTurn=function(){for(var a=0;a<NUM_PLAYERS;a++)this._aPlayersHand[a].setOffTurn(a),this.offInputPlayer(a)};CGameBase.prototype.prevTurn=function(){this._oTurnManager.prevTurn()};CGameBase.prototype.getPlayerTurn=function(){return this._iCurPlayer};CGameBase.prototype.getbUNO=function(){return this._bUNO};
CGameBase.prototype.cardCanBePlayed=function(a,b){if(a.getFotogram()===FOTOGRAM_DRAW_FOUR){var c=!1;for(var f=0;f<this._aPlayersHand[b].getLength();f++){var e=this._aPlayersHand[b].getCardByIndex(f);if(e.getFotogram()!==FOTOGRAM_DRAW_FOUR&&(e.getRank()===this._oUsedCards.getLastCard().getRank()||e.getSuit()===this._iCurrentColor||e.getFotogram()===FOTOGRAM_COLOR)){c=!0;break}}c=!c}else c=a.getFotogram()===FOTOGRAM_COLOR?!0:this.cardMatchTheWaste(a);return c};
CGameBase.prototype.cardMatchTheWaste=function(a){var b=!1;if(a.getRank()===this._oUsedCards.getLastCard().getRank()||a.getSuit()===this._iCurrentColor||a.getFotogram()===FOTOGRAM_COLOR||a.getFotogram()===FOTOGRAM_DRAW_FOUR)b=!0;return b};CGameBase.prototype.playerCanPlay=function(a){for(var b=!1,c=0;c<this._aPlayersHand[a].getLength();c++){var f=this._aPlayersHand[a].getCardByIndex(c);if(this.cardMatchTheWaste(f)){b=!0;break}}return b};
CGameBase.prototype._getCardRotation=function(a){var b=0;switch(this._aPlayersHand[a].getSide()){case BOTTOM:b=0;break;case LEFT:b=90;break;case TOP:b=180;break;case RIGHT:b=-90}return b};CGameBase.prototype.shuffle=function(a){var b;for(b=a.length;b;b--){var c=Math.floor(Math.random()*b);var f=a[b-1];a[b-1]=a[c];a[c]=f}};
CGameBase.prototype.unload=function(){this._oUnoController.unload();this._oInterface.unload();this._oSummaryPanel.unload();this._oMsgBox.unload();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};
CGameBase.prototype.gameOver=function(a){this.setOffTurn();this._showAllPlayersCards();this._showAllPlayersMatchScore();var b=this._calculateMatchScore(),c=this._aPlayersHand[a].getScore()+b;this._aPlayersHand[a].setOnTurn();this._aPlayersHand[a].setScore(c);var f=this._getPlayersRank();this._oSummaryPanel.setAndShow(f,a,b);c>=GAME_SCORE_WIN&&(this._bEndGame=!0,this._oSummaryPanel.endMode(sprintf(TEXT_PLAYER_WON,this._aPlayersHand[a].getName())),$(s_oMain).trigger("share_event",c))};
CGameBase.prototype.checkWinner=function(){for(var a=null,b=0;b<this._aPlayersHand.length;b++)if(0===this._aPlayersHand[b].getLength()){a=b;break}return a};CGameBase.prototype._calculateMatchScore=function(){for(var a=0,b=0;b<this._aPlayersHand.length;b++)a+=this._aPlayersHand[b].calculateHandScore();return a};CGameBase.prototype._showAllPlayersCards=function(){for(var a=0;a<this._aPlayersHand.length;a++)this._aPlayersHand[a].getSide()!==BOTTOM&&this._aPlayersHand[a].showAllCards()};
CGameBase.prototype._showAllPlayersMatchScore=function(){for(var a=0;a<this._aPlayersHand.length;a++){var b=this._aPlayersHand[a].calculateHandScore();0<this._aPlayersHand[a].getLength()?this._aPlayersHand[a].showHandScore(sprintf(TEXT_PTS_TO_WINNER,b)):this._aPlayersHand[a].showHandScore(TEXT_WINNER)}};
CGameBase.prototype._getPlayersRank=function(){for(var a=[],b=0;b<this._aPlayersHand.length;b++){var c=this._aPlayersHand[b].getName(),f=this._aPlayersHand[b].getScore();a.push({name:c,score:f,index:b})}a.sort(function(e,d){return e.score>d.score?-1:1});return a};CGameBase.prototype.matchCanStart=function(){for(var a=!1,b=0,c=0;c<this._aPlayersHand.length;c++)this._aPlayersHand[c].getLength()===STARTING_NUM_CARDS&&b++;b===NUM_PLAYERS&&(a=!0);return a};
CGameBase.prototype._checkUnoNotify=function(a,b,c){a&&(c===b?(a=sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),this._oUnoController.unoAnimation()):(a=this._aPlayersHand[c].getName().toUpperCase(),a=sprintf(TEXT_ALERT_2,a,NUM_PENALTY_CARDS)),this._oUnoController.showAlertMsg(a))};CGameBase.prototype.canCardBeShown=function(a){return this._aPlayersHand[a].getSide()===BOTTOM||DEBUG_SHOW_CARDS};CGameBase.prototype.getPlayersHand=function(a){return this._aPlayersHand[a]};CGameBase.prototype.getCurColor=function(a){return this._iCurrentColor};
CGameBase.prototype.getLastCard=function(a){return this._oUsedCards.getLastCard()};CGameBase.prototype.update=function(){};CGameBase.prototype._onCheck=function(){this._oSummaryPanel.hide()};function CGameSingle(a){CGameBase.call(this,a);!0===s_bFirstGame?new CPanelTutorial:this._startGame()}CGameSingle.prototype=Object.create(CGameBase.prototype);
CGameSingle.prototype._startGame=function(){s_bFirstGame=!1;this._oUnoController.setVisible(!0);this._oUnoController.addEventListener(ON_APPLY_EFFECT,this.applyEffectOnCard,this);this._oUnoController.addEventListener(ON_APPLY_PENALITY,this.applyPenality,this);this._oUnoController.addEventListener(ON_UNO_CLICK,this._onUnoClick,this);this._oSummaryPanel.addEventListener(ON_NEXT,this._onConfirmNextMatch,this);this._oSummaryPanel.addEventListener(ON_HOME,this.onExit,this);this._oMsgBox.addEventListener(ON_HOME,
this.onExit,this);this._setPieces()};CGameSingle.prototype._setPieces=function(){this._oDeck.initializeDeck();this._oDeck.shuffle();this.getFirstHand()};CGameSingle.prototype.setNewGame=function(){for(var a=0;a<this._aPlayersHand.length;a++)this._aPlayersHand[a].setScore(0);this._oTurnManager.resetFirstPlayer()};CGameSingle.prototype.restart=function(){this.reset();this._setPieces()};
CGameSingle.prototype._checkFirstCardEffect=function(a){switch(a){case EFFECT_SELECT_COLOR:this._oTurnManager.nextTurn();this._iCurPlayer=this._oTurnManager.getTurn();this._iNextPlayer=this._oTurnManager.getNextPlayer();this._applySelectColor();this._oTurnManager.prevTurn();break;case EFFECT_DRAW_FOUR:this._oTurnManager.nextTurn();this._iCurPlayer=this._oTurnManager.getTurn();this._iNextPlayer=this._oTurnManager.getNextPlayer();this._iNextPlayer=this._iCurPlayer=this._oTurnManager.getTurn();this._applyDrawFourEffect();
this._oTurnManager.prevTurn();break;case EFFECT_STOP:this._applyStopTurn();break;case EFFECT_INVERT_TURN:2!==NUM_PLAYERS&&this._oTurnManager.nextTurn();this._applyInvertTurn();break;case EFFECT_DRAW_TWO_COLORED:this._applyDrawTwoColored();break;default:this._oTurnManager.nextTurn(),this._iCurPlayer=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),0===this._iCurPlayer?(this.onInputPlayer(this._iCurPlayer),this._oDeck.enableInputDraw()):this._oAIManager.selectACard(this._iCurPlayer),
this._aPlayersHand[this._iCurPlayer].setOnTurn()}};
CGameSingle.prototype.onNextTurn=function(){this._bUNO=!1;var a=this.checkWinner();null!==a?(this.gameOver(a),0===a&&$(s_oMain).trigger("save_score",this._calculateMatchScore())):(this.setOffTurn(),this._oDeck.enableInputDraw(),this._oTurnManager.nextTurn(),this._iCurPlayer=a=this._oTurnManager.getTurn(),this._iNextPlayer=this._oTurnManager.getNextPlayer(),this._aPlayersHand[a].setOnTurn(),0===a?(this.onInputPlayer(a),this.playerCanPlay(a)||this._oDeck.setHelp()):this._oAIManager.selectACard(a))};
CGameSingle.prototype.playCard=function(a,b){var c=this._oTurnManager.getTurn(),f=!1;0===c&&(f=this.cardCanBePlayed(a,c));f&&(this._oCardsContainer.addChildAt(this._oHandsContainer,this._oCardsContainer.numChildren),this._aPlayersHand[c].setOnTop(),this._oDeck.disableInputDraw(),this.offInputPlayer(0),c=this._aPlayersHand[c].getContainerPos(),f=this._oUsedCards.getGlobalPosition(),playSound("card",1,!1),a.moveCard(f.x-c.x,f.y-c.y,0,300),a.showCard(),this._oUsedCards.setChildDepth(2))};
CGameSingle.prototype.playedCard=function(a){var b=this._oTurnManager.getTurn(),c=this._aPlayersHand[b].searchIndexCard(a);this._oUsedCards.pushCard(new CCard(0,0,this._oUsedCards.getContainer(),a.getFotogram(),a.getRank(),a.getSuit(),a.getUniqueID(),0));this._oUsedCards.disableInputUsedCards();this._oUsedCards.getLastCard().instantShow();this._aPlayersHand[b].removeCardByIndex(c);a.unload();4!==this._oUsedCards.getLastCard().getSuit()&&(this._iCurrentColor=this._oUsedCards.getLastCard().getSuit(),
this._oInterface.refreshColor(this._iCurrentColor));this._aPlayersHand[b].organizeHand(c);this.checkUno(a.getEffect());0!==b&&this._onUnoClick()};CGameSingle.prototype._onUnoClick=function(){!0===this._bUNO&&(this._bUNO=!1,this._aPlayersHand[this._iCurPlayer].checkUno())};CGameSingle.prototype.applyEffectOnCard=function(a){this._checkEffect(a)};
CGameSingle.prototype._applySelectColor=function(){if(0===this._iCurPlayer)(new CSelectColorPanel(EFFECT_SELECT_COLOR)).addEventListener(ON_COLOR_SELECTED,function(b){this._onActionSelectColor({colorindex:b})},this);else{var a={colorindex:this._oAIManager.onSelectColorCpu(this._iCurPlayer)};this._onActionSelectColor(a)}};
CGameSingle.prototype._applyDrawFourEffect=function(){if(0===this._iCurPlayer)(new CSelectColorPanel(EFFECT_DRAW_FOUR)).addEventListener(ON_COLOR_SELECTED,function(b){this._onActionDrawFour({playerindex:this._iNextPlayer,colorindex:b})},this);else{var a=this._oAIManager.onSelectColorCpu(this._iCurPlayer);this._onActionDrawFour({playerindex:this._iNextPlayer,colorindex:a})}};
CGameSingle.prototype._applyStopTurn=function(){var a=this;this._oAnimation.stopTurn().then(function(){a._oTurnManager.nextTurn();a._notifyChangeTurn()})};CGameSingle.prototype._applyInvertTurn=function(){var a=this;this._oTurnManager.changeClockWise();2===NUM_PLAYERS&&this._oTurnManager.nextTurn();this._oAnimation.changeClockWise(s_oGame._oTurnManager.getClockWise()).then(function(){a._notifyChangeTurn()})};
CGameSingle.prototype._applyDrawTwoColored=function(){this.drawCards(this._iNextPlayer,2,0,DRAW_TYPE_DRAW2_COLORED)};CGameSingle.prototype._applyNormalCardEffect=function(){this._notifyChangeTurn()};CGameSingle.prototype.drawCards=function(a,b,c,f){this._checkUnoNotify(f===DRAW_TYPE_PENALITY?!0:!1,0,a);this._checkNumberCardsToDraw(a,b,c,f)};CGameSingle.prototype._notifyChangeTurn=function(){s_oGame.onNextTurn()};
CGameSingle.prototype.shuffleCards=function(a,b,c,f){for(var e=this,d=this._oUsedCards.removeAllCardUnderTheDeck(),h=[],g=0;g<d.length;g++)h.push(d[g].getFotogram());console.log(h);this._oAnimation.shuffleAnimation().then(function(){shuffle(h);e._oDeck.clearCards();e._oDeck.initializeFromData(h);e.checkForMoreDraws(a,b,c,f)})};CGameSingle.prototype._onAllCardsDrawCompleted=function(a,b){this._checkEffectAfterDrawCompleted(a,b)};
CGameSingle.prototype._checkIfCanStillPlayTheTurn=function(a){this.playerCanPlay(a)?(this.onInputPlayer(a),0!==this._iCurPlayer&&this._oAIManager.selectACard(this._iCurPlayer)):(this._aPlayersHand[a].centerContainer(),this._notifyChangeTurn())};CGameSingle.prototype._onActionDrawFour=function(a){var b=this;this._iCurrentColor=a.colorindex;this._oAnimation.changeColor(this._iCurrentColor).then(function(){b._oInterface.refreshColor(b._iCurrentColor);b.drawCards(a.playerindex,NUM_WILD_CARDS,0,DRAW_TYPE_DRAW4)})};
CGameSingle.prototype._onActionSelectColor=function(a){var b=this;this._iCurrentColor=a.colorindex;this._oAnimation.changeColor(this._iCurrentColor).then(function(){b._oInterface.refreshColor(b._iCurrentColor);b._notifyChangeTurn()})};CGameSingle.prototype._onConfirmNextMatch=function(){$(s_oMain).trigger("show_interlevel_ad");this._bEndGame&&(this._bEndGame=!1,this.setNewGame());this.restart()};
CGameSingle.prototype.onExit=function(){s_oGame.unload();s_oMain.gotoMenu();$(s_oMain).trigger("end_session");$(s_oMain).trigger("show_interlevel_ad")};
function CInterface(){var a,b,c,f,e,d,h,g,n,l,m,p,k=null,w=null,t;this._init=function(){t=new createjs.Container;var y=s_oSpriteLibrary.getSprite("but_exit");e=CANVAS_WIDTH-y.height/2-10;d=y.height/2+10;l=new CGfxButton(e,d,y,t);l.addEventListener(ON_MOUSE_UP,this._onExit,this);c=CANVAS_WIDTH-y.width/2-100;f=y.height/2+10;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)y=s_oSpriteLibrary.getSprite("audio_icon"),n=new CToggle(c,f,y,s_bAudioActive,t),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,
this);y=window.document;var x=y.documentElement;k=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;w=y.exitFullscreen||y.mozCancelFullScreen||y.webkitExitFullscreen||y.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(k=!1);k&&screenfull.isEnabled&&(y=s_oSpriteLibrary.getSprite("but_fullscreen"),a=y.width/4+10,b=y.height/2+10,m=new CToggle(a,b,y,s_bFullscreen,t),m.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));y=s_oSpriteLibrary.getSprite("colors");y=new createjs.SpriteSheet({images:[y],
frames:{width:103,height:102,regX:51.5,regY:51},animations:{red:[0],green:[1],blue:[2],yellow:[3]}});h=CANVAS_WIDTH/2+220;g=CANVAS_HEIGHT/2-60;p=new createjs.Sprite(y,0);p.stop();p.x=h;p.y=g;s_oStage.addChild(t);this.refreshButtonPos()};this.refreshColor=function(y){p.gotoAndStop(y);s_oStage.addChildAt(p,1)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)n.unload(),n=null;l.unload();k&&screenfull.isEnabled&&m.unload();s_oInterface=null};this.refreshButtonPos=function(){l.setPosition(e-
s_iOffsetX,s_iOffsetY+d);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(c-s_iOffsetX,s_iOffsetY+f);k&&screenfull.isEnabled&&m.setPosition(a+s_iOffsetX,b+s_iOffsetY)};this.setOnTop=function(){s_oStage.addChildAt(t,s_oStage.numChildren)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit)};this._onRestart=function(){s_oGame.restart()};this.resetFullscreenBut=function(){k&&screenfull.isEnabled&&
m.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?w.call(window.document):k.call(window.document.documentElement);sizeHandler()};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CCreditsPanel(){var a,b,c,f,e;this._init=function(){b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=0;b.on("mousedown",function(){});s_oStage.addChild(b);(new createjs.Tween.get(b)).to({alpha:.7},500);c=new createjs.Container;s_oStage.addChild(c);var d=s_oSpriteLibrary.getSprite("credits_panel"),h=createBitmap(d);h.regX=d.width/2;h.regY=d.height/2;c.addChild(h);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT+d.height/2;a=c.y;(new createjs.Tween.get(c)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.quartIn);h=new createjs.Text(TEXT_DEVELOPED,"20px "+PRIMARY_FONT,"#ffffff");h.y=-d.height/2+80;h.textAlign="center";h.textBaseline="middle";h.lineWidth=300;c.addChild(h);d=new createjs.Text("www.codethislab.com","30px "+PRIMARY_FONT,"#ffffff");d.y=80;d.textAlign="center";d.textBaseline="middle";d.lineWidth=500;c.addChild(d);d=s_oSpriteLibrary.getSprite("ctl_logo");e=createBitmap(d);e.on("click",this._onLogoButRelease);e.regX=d.width/2;e.regY=d.height/2;c.addChild(e);d=s_oSpriteLibrary.getSprite("but_exit");
f=new CGfxButton(230,-107,d,c);f.addEventListener(ON_MOUSE_UP,this.unload,this)};this.unload=function(){f.setClickable(!1);(new createjs.Tween.get(b)).to({alpha:0},500);(new createjs.Tween.get(c)).to({y:a},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(b);s_oStage.removeChild(c);f.unload()});b.off("mousedown",function(){});e.off("mousedown",this._onLogoButRelease)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en")};this._init()}
function CSelectColorPanel(a){var b,c,f,e,d,h,g=this,n,l,m,p;this._init=function(){c=[];f=[];a===EFFECT_SELECT_COLOR&&playSound("special_card",.5,!1);e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;e.on("mousedown",function(){});s_oStage.addChild(e);(new createjs.Tween.get(e,{override:!0})).to({alpha:.7},500);d=new createjs.Container;s_oStage.addChild(d);h=new createjs.Container;d.addChild(h);var k=s_oSpriteLibrary.getSprite("select_color_panel"),
w=createBitmap(k);w.regX=k.width/2;w.regY=k.height/2;d.addChildAt(w,0);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT+k.height/2;b=d.y;(new createjs.Tween.get(d,{override:!0})).to({y:CANVAS_HEIGHT/2-40},600,createjs.Ease.backOut);new CTLText(d,-250,-k.height/2+10,500,110,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_COLOR,!0,!0,!0,!1);h.y=d.getBounds().height/5;k=s_oSpriteLibrary.getSprite("but_red");n=new CGfxButton(-190,-20,k,h);n.addEventListener(ON_MOUSE_UP,function(){g.onSelectColor(0);h});k=s_oSpriteLibrary.getSprite("but_green");
l=new CGfxButton(-65,-20,k,h);l.addEventListener(ON_MOUSE_UP,function(){g.onSelectColor(1);h});k=s_oSpriteLibrary.getSprite("but_blue");m=new CGfxButton(65,-20,k,h);m.addEventListener(ON_MOUSE_UP,function(){g.onSelectColor(2);h});k=s_oSpriteLibrary.getSprite("but_yellow");p=new CGfxButton(190,-20,k,h);p.addEventListener(ON_MOUSE_UP,function(){g.onSelectColor(3);h})};this.unload=function(){s_oStage.removeChild(e);s_oStage.removeChild(d);n.unload();l.unload();m.unload();p.unload();e.off("mousedown",
function(){})};this.disableButtons=function(){n.setClickable(!1);l.setClickable(!1);m.setClickable(!1);p.setClickable(!1)};this.addEventListener=function(k,w,t){c[k]=w;f[k]=t};this.onSelectColor=function(k){(new createjs.Tween.get(e,{override:!0})).to({alpha:0},500);(new createjs.Tween.get(d,{override:!0})).to({y:b},400,createjs.Ease.backIn);g.disableButtons();c[ON_COLOR_SELECTED]&&c[ON_COLOR_SELECTED].call(f[ON_COLOR_SELECTED],k,a)};g=this;this._init()}
function CAreYouSurePanel(a){var b,c,f,e,d;this._init=function(g){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;e.on("mousedown",function(){});s_oStage.addChild(e);(new createjs.Tween.get(e)).to({alpha:.7},500);d=new createjs.Container;s_oStage.addChildAt(d,s_oStage.numChildren);g=s_oSpriteLibrary.getSprite("credits_panel");var n=createBitmap(g);n.regX=g.width/2;n.regY=g.height/2;d.addChild(n);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT+g.height/2;
b=d.y;(new createjs.Tween.get(d)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.quartIn).call(function(){});(new CTLText(d,-250,-130,500,150,50,"center","#000000",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1)).setOutline(5);new CTLText(d,-250,-130,500,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);c=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes_big"),d);c.addEventListener(ON_MOUSE_UP,this._onButYes,this);f=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_exit_big"),
d);f.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this._onButYes=function(){f.setClickable(!1);c.setClickable(!1);(new createjs.Tween.get(e)).to({alpha:0},500);(new createjs.Tween.get(d)).to({y:b},400,createjs.Ease.backIn).call(function(){a();h.unload()})};this._onButNo=function(){f.setClickable(!1);c.setClickable(!1);(new createjs.Tween.get(e)).to({alpha:0},500);(new createjs.Tween.get(d)).to({y:b},400,createjs.Ease.backIn).call(function(){h.unload()})};this.unload=function(){f.unload();c.unload();
s_oStage.removeChild(e);s_oStage.removeChild(d);e.off("mousedown",function(){})};var h=this;this._init(a)}
function CAIManager(){this._init=function(){};this.unload=function(){};this.onSelectColorCpu=function(a){a=s_oGame.getPlayersHand(a);for(var b,c=[{iColor:0,iPoints:0},{iColor:1,iPoints:0},{iColor:2,iPoints:0},{iColor:3,iPoints:0}],f=0;f<a.getLength();f++){b=a.getCardByIndex(f);for(var e=0;e<c.length;e++)b.getSuit()===e&&c[e].iPoints++}c.sort(function(d,h){return parseFloat(h.iPoints)-parseFloat(d.iPoints)});return c[0].iColor};this.selectACard=function(a){for(var b=s_oGame.getPlayersHand(a),c=s_oGame.getCurColor(),
f=s_oGame.getLastCard(),e=[],d=0;d<b.getLength();d++)4===b.getCardByIndex(d).getSuit()||b.getCardByIndex(d).getRank()!==f.getRank()&&b.getCardByIndex(d).getSuit()!==c?b.getCardByIndex(d).getFotogram()===FOTOGRAM_COLOR?e.push({oCard:b.getCardByIndex(d),iValue:2}):b.getCardByIndex(d).getFotogram()===FOTOGRAM_DRAW_FOUR&&e.push({oCard:b.getCardByIndex(d),iValue:1}):12===b.getCardByIndex(d).getRank()?e.push({oCard:b.getCardByIndex(d),iValue:6}):10===b.getCardByIndex(d).getRank()?e.push({oCard:b.getCardByIndex(d),
iValue:5}):11===b.getCardByIndex(d).getRank()?e.push({oCard:b.getCardByIndex(d),iValue:4}):e.push({oCard:b.getCardByIndex(d),iValue:3});0===e.length?s_oGame.drawCards(a,1,1E3,DRAW_TYPE_NORMAL):(e.sort(function(h,g){return parseFloat(g.iValue)-parseFloat(h.iValue)}),s_oGame.cpuPlayCard(e[0].oCard))};this._init()}
function CUnoController(){var a,b,c,f,e;this._init=function(){a=[];b=[];f=new createjs.Container;f.visible=!1;s_oStage.addChild(f);var h=s_oSpriteLibrary.getSprite("but_uno");e=new CGfxButton(CANVAS_WIDTH/2+222,CANVAS_HEIGHT/2+70,h,f);e.addEventListener(ON_MOUSE_UP,this._onButUno,this);c=new CTLText(f,CANVAS_WIDTH/2+280,CANVAS_HEIGHT/2,200,150,50,"center","#fff",PRIMARY_FONT,1,0,0,sprintf(TEXT_ALERT_1,NUM_PENALTY_CARDS),!0,!0,!0,!1);c.setAlpha(0)};this.unload=function(){e.unload()};this.addEventListener=
function(h,g,n){a[h]=g;b[h]=n};this.setVisible=function(h){f.visible=h};this.check=function(h){!0===s_oGame.getbUNO()?setTimeout(function(){!0===s_oGame.getbUNO()?d._triggerPenality():d._triggerEffect(h)},2E3):d._triggerEffect(h)};this._triggerPenality=function(){a[ON_APPLY_PENALITY]&&a[ON_APPLY_PENALITY].call(b[ON_APPLY_PENALITY])};this._triggerEffect=function(h){a[ON_APPLY_EFFECT]&&a[ON_APPLY_EFFECT].call(b[ON_APPLY_EFFECT],h)};this._onButUno=function(){a[ON_UNO_CLICK]&&a[ON_UNO_CLICK].call(b[ON_UNO_CLICK])};
this.showAlertMsg=function(h){c.refreshText(h);createjs.Tween.get(c.getText()).to({alpha:1},400).wait(4E3).to({alpha:0},400).call(function(){e.removeAnimation()})};this.unoAnimation=function(){e.trembleAnimation()};var d=this;this._init()}
function CSummaryPanel(a){var b,c,f,e,d,h,g,n,l,m,p,k,w,t;this._init=function(){b=[];c=[];d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;d.on("mousedown",function(){});a.addChild(d);g=new createjs.Container;g.alpha=0;g.visible=!1;a.addChild(g);var x=s_oSpriteLibrary.getSprite("msg_box");h=createBitmap(x);x=h.getBounds();h.regX=x.width/2;h.regY=x.height/2;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2;g.addChild(h);m=new createjs.Container;m.x=h.x;m.y=
h.y-10;g.addChild(m);var E=NUM_PLAYERS;x=40*E;e=[];for(var q=0;q<E;q++)e[q]=new CPlayerInfo(0,0,m,"szPlayerName"),e[q].setPosition(0,-x/2+x/(E-1)*q,BOTTOM);f="#35bd1b";l=new createjs.Text(0," 30px "+PRIMARY_FONT,f);l.textBaseline="middle";m.addChild(l);E=CANVAS_WIDTH/2;q=CANVAS_HEIGHT/2-185;x=150;n=new CTLText(g,E-250,q-x/2,500,x,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SUMMARY,!0,!0,!0,!1);x=s_oSpriteLibrary.getSprite("cup_icon");p=createBitmap(x);p.regX=x.width/2;p.regY=x.height/2;p.x=-300;p.y=
e[0].getTextScorePos().y;p.visible=!1;m.addChild(p);x=s_oSpriteLibrary.getSprite("but_home");k=new CGfxButton(CANVAS_WIDTH/2-180,CANVAS_HEIGHT/2+170,x,g);k.addEventListener(ON_MOUSE_DOWN,this._onExit,this);x=s_oSpriteLibrary.getSprite("but_show");w=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,x,g);w.addEventListener(ON_MOUSE_DOWN,this._onShow,this);x=s_oSpriteLibrary.getSprite("but_next");t=new CGfxButton(CANVAS_WIDTH/2+180,CANVAS_HEIGHT/2+170,x,g);t.addEventListener(ON_MOUSE_DOWN,this._onNext,
this);t.pulseAnimation()};this.unload=function(){t.unload();w.unload();k.unload();d.removeAllEventListeners();g.removeAllEventListeners();a.removeChild(d);a.removeChild(g)};this.addEventListener=function(x,E,q){b[x]=E;c[x]=q};this.setAndShow=function(x,E,q){for(var F=0;F<e.length;F++)if(e[F].setName(x[F].name),e[F].setScore(x[F].score+" /"+GAME_SCORE_WIN),x[F].index===E){var D=e[F].getTextScorePos();l.x=D.x+46;l.y=D.y+18;l.text="(+"+q+")";e[F].highlight()}playSound("game_over",1,!1);g.visible=!0;
createjs.Tween.get(d).to({alpha:.7},500);createjs.Tween.get(g).to({alpha:1},500)};this.reset=function(){g.visible=!1;d.alpha=0;d.on("mousedown",function(){});p.visible=!1;n.setY(CANVAS_HEIGHT/2-185-75);n.refreshText(TEXT_SUMMARY);m.visible=!0;k.setX(CANVAS_WIDTH/2-180);w.setX(CANVAS_WIDTH/2);t.setX(CANVAS_WIDTH/2+180);k.setVisible(!0);w.setVisible(!0);t.setVisible(!0);var x=s_oSpriteLibrary.getSprite("but_next");t.setImage(x);for(x=0;x<e.length;x++)e[x].enable(),e[x].setNameColor("#FFF")};this.show=
function(){g.visible=!0;d.alpha=.7;d.removeAllEventListeners();d.on("mousedown",function(){})};this.hide=function(){g.visible=!1;d.alpha=.01;d.removeAllEventListeners();d.on("mousedown",this.show,this)};this.waitingMode=function(){g.visible=!0;g.alpha=1;d.alpha=.7;m.visible=!1;n.refreshText(TEXT_WAIT_OPPONENT);n.setY(CANVAS_HEIGHT/2-50-75);k.setX(CANVAS_WIDTH/2-100);t.setVisible(!1);w.setX(CANVAS_WIDTH/2+100)};this.playerQuitMode=function(x){g.visible=!0;g.alpha=1;d.alpha=.7;n.refreshText(x.toUpperCase());
k.setX(CANVAS_WIDTH/2-100);t.setVisible(!1);w.setX(CANVAS_WIDTH/2+100)};this.endMode=function(x){n.refreshText(x.toUpperCase());x=s_oSpriteLibrary.getSprite("but_restart");t.setImage(x);e[0].setNameColor(f);p.visible=!0};this.isShown=function(){return g.visible};this.stopTweens=function(){createjs.Tween.removeTweens(d);createjs.Tween.removeTweens(g)};this._onExit=function(){y.stopTweens();b[ON_HOME]&&b[ON_HOME].call(c[ON_HOME])};this._onShow=function(){y.stopTweens();b[ON_CHECK]&&b[ON_CHECK].call(c[ON_CHECK])};
this._onNext=function(){y.stopTweens();b[ON_NEXT]&&b[ON_NEXT].call(c[ON_NEXT])};this._init();var y=this;return this}
function CPlayerInfo(a,b,c,f){var e,d,h,g,n,l,m,p,k,w,t;this._init=function(y,x,E,q){e=q;d=10;l=new createjs.Container;l.x=y;l.y=x;E.addChild(l);m=new createjs.Container;l.addChild(m);y=s_oSpriteLibrary.getSprite("line_player");h=y.width/2;g=y.height;y=new createjs.SpriteSheet({images:[y],frames:{width:h,height:g,regX:h/2,regY:g/2},animations:{off:[0],on:[1],idle:{frames:[0,1],speed:.1}}});p=createSprite(y,"off",h/2,g/2,h,g);p.stop();l.addChild(p);n=40;k=new CTLText(m,0,0,340,n,30,"left","#fff",PRIMARY_FONT,
1,0,0,e,!0,!0,!1,!1);y=s_oSpriteLibrary.getSprite("score_icon");t=createBitmap(y);t.regX=y.width/2;t.regY=y.height/2;m.addChild(t);w=new CTLText(m,0,0,100,n,30,"left","#fff",PRIMARY_FONT,1,0,0,"0",!0,!0,!1,!1)};this.unload=function(){c.removeChild(l)};this.highlight=function(){p.gotoAndStop("on");m.alpha=1;createjs.Tween.get(k.getText(),{override:!0,loop:!0}).to({alpha:0},500,createjs.Ease.cubicIn).to({alpha:1},500,createjs.Ease.cubicOut).wait(500)};this.enable=function(){p.gotoAndStop("on");k.setAlpha(1);
m.alpha=1;createjs.Tween.removeTweens(k.getText())};this.disable=function(){p.gotoAndStop("off");k.setAlpha(1);m.alpha=.15;createjs.Tween.removeTweens(k.getText())};this.setScore=function(y){w.refreshText(y)};this.setName=function(y){k.refreshText(y)};this.setPosition=function(y,x,E){l.x=y;l.y=x;switch(E){case BOTTOM:this._setBottom();break;case TOP:this._setTop();break;case LEFT:this._setLeft();break;case RIGHT:this._setRight()}};this._setBottom=function(){this._setNormalDir();l.rotation=0};this._setTop=
function(){this._setInverseDir();l.rotation=0};this._setLeft=function(){this._setNormalDir();l.rotation=90};this._setRight=function(){this._setInverseDir();l.rotation=90};this._setNormalDir=function(){k.setAlign("left");k.setPos(-h/2+d,-n);t.x=h/2-d-t.getBounds().width/2;t.y=k.getY()+n/2-2;w.setAlign("right");w.setPos(t.x-t.getBounds().width/2-2,k.getY())};this._setInverseDir=function(){k.setAlign("right");k.setPos(h/2-d,4);t.x=-h/2+d+t.getBounds().width/2;t.y=k.getY()+n/2-2;w.setAlign("left");w.setPos(t.x+
t.getBounds().width/2+2,k.getY())};this.getTextScorePos=function(){return{x:l.x+w.getX(),y:l.y+w.getY()}};this.setNameColor=function(y){k.setColor(y)};this._init(a,b,c,f)}
function CInfoLabel(a,b,c){var f,e;this._init=function(d,h,g){f=new createjs.Container;f.x=d;f.y=h;g.addChild(f);d=s_oSpriteLibrary.getSprite("info_label");h=createBitmap(d);h.regX=d.width/2;h.regY=d.height/2;f.addChild(h);d=d.width-20;e=new CTLText(f,-(d/2),-40,d,80,30,"center","#fff",PRIMARY_FONT,1.2,0,0,sprintf(TEXT_PTS_TO_WINNER,0),!0,!0,!0,!1);this.pulseAnimation()};this.setOnTop=function(){c.setChildIndex(f,c.numChildren-1)};this.setPosition=function(d,h,g){f.x=d;f.y=h};this.setTextScore=function(d){e.refreshText(d)};
this.setVisible=function(d){f.visible=d};this.pulseAnimation=function(){createjs.Tween.get(f,{loop:!0}).to({scaleX:.9,scaleY:.9},850,createjs.Ease.quadOut).to({scaleX:1,scaleY:1},650,createjs.Ease.quadIn)};this._init(a,b,c)}
function CMsgBox(a){var b,c,f,e,d,h,g;this._init=function(n){b=[];c=[];f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=0;f.on("mousedown",function(){});n.addChild(f);e=new createjs.Container;e.alpha=0;e.visible=!1;n.addChild(e);n=s_oSpriteLibrary.getSprite("msg_box");d=createBitmap(n);n=d.getBounds();d.regX=n.width/2;d.regY=n.height/2;d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT/2;e.addChild(d);h=new CTLText(e,CANVAS_WIDTH/2-250,CANVAS_HEIGHT/2-50-75,500,
150,50,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!0,!1);n=s_oSpriteLibrary.getSprite("but_home");g=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+170,n,e);g.addEventListener(ON_MOUSE_DOWN,this._onExit,this)};this.unload=function(){g.unload();f.removeAllEventListeners();e.removeAllEventListeners();a.removeChild(f);a.removeChild(e)};this.addEventListener=function(n,l,m){b[n]=l;c[n]=m};this.show=function(n){playSound("game_over",1,!1);e.visible=!0;h.refreshText(n.toUpperCase());createjs.Tween.get(f).to({alpha:.7},
500);createjs.Tween.get(e).to({alpha:1},500)};this._onExit=function(){b[ON_HOME]&&b[ON_HOME].call(c[ON_HOME])};this.isShown=function(){return e.visible};this._init(a)};